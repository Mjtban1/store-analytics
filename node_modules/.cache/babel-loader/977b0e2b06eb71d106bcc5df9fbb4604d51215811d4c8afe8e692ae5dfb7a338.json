{"ast":null,"code":"import React,{useState,useEffect}from'react';import{db}from'../../firebase/config';import{collection,addDoc,getDocs,deleteDoc,doc,query,where,orderBy}from'firebase/firestore';import RevenueChart from'../Charts/RevenueChart';import OrderTypesChart from'../Charts/OrderTypesChart';import'./Dashboard.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Dashboard=()=>{const[activeSection,setActiveSection]=useState('orders');const[showCustomInput,setShowCustomInput]=useState(false);const[customProductName,setCustomProductName]=useState('');const[customProducts,setCustomProducts]=useState({games:[],subscriptions:[],services:[]});const[formData,setFormData]=useState({productName:'',costPrice:'',sellingPrice:'',description:'',serviceType:'games',// القيمة الافتراضية\nsubType:''// نوع المنتج الفرعي\n});const[capitalHistory,setCapitalHistory]=useState([]);const[newCapital,setNewCapital]=useState({amount:'',note:'',date:new Date().toISOString().split('T')[0]});const[totalCapital,setTotalCapital]=useState(0);const[capitalFilter,setCapitalFilter]=useState({startDate:'',endDate:''});// إضافة حالة جديدة لإدارة نافذة التأكيد\nconst[deleteModal,setDeleteModal]=useState({isOpen:false,itemId:null});const[orders,setOrders]=useState([]);const[analytics,setAnalytics]=useState({totalRevenue:0,totalCost:0,totalProfit:0,profitMargin:0,ordersByType:{},revenueByType:{}});const sections={orders:{title:'تسجيل الطلبات',icon:'📦'},capital:{title:'رأس المال',icon:'💰'},analytics:{title:'تحليل الطلبات',icon:'📊'},archive:{title:'الأرشيف',icon:'📂'}};const handleInputChange=e=>{setFormData({...formData,[e.target.name]:e.target.value});};const validateForm=()=>{var _formData$productName;return((_formData$productName=formData.productName)===null||_formData$productName===void 0?void 0:_formData$productName.trim())&&formData.costPrice&&formData.sellingPrice&&formData.serviceType&&formData.subType;};const handleSubmit=async e=>{e.preventDefault();if(!validateForm()){alert('يرجى ملء جميع الحقول المطلوبة');return;}try{const orderData={...formData,timestamp:new Date(),// Store as Date object\nprofit:Number(formData.sellingPrice)-Number(formData.costPrice),profitMargin:(Number(formData.sellingPrice)-Number(formData.costPrice))/Number(formData.sellingPrice)*100};const docRef=await addDoc(collection(db,'orders'),orderData);// Update local state with the correct timestamp\nsetOrders(prev=>[...prev,{id:docRef.id,...orderData}]);updateAnalytics([...orders,orderData]);// Reset form\nsetFormData({productName:'',costPrice:'',sellingPrice:'',description:'',serviceType:'games',subType:''});alert('تم تسجيل المنتج بنجاح');}catch(error){console.error(\"Error adding order:\",error);alert('حدث خطأ أثناء تسجيل المنتج');}};// إضافة useEffect لجلب المنتجات المخصصة عند تحميل المكون\nuseEffect(()=>{const fetchCustomProducts=async()=>{try{const customProductsRef=collection(db,'customProducts');const querySnapshot=await getDocs(customProductsRef);const products={games:[],subscriptions:[],services:[]};querySnapshot.forEach(doc=>{const product={id:doc.id,...doc.data()};products[product.category].push(product);});setCustomProducts(products);}catch(error){console.error(\"Error fetching custom products:\",error);}};fetchCustomProducts();},[]);useEffect(()=>{fetchCapitalHistory();},[]);const fetchCapitalHistory=async()=>{try{const capitalRef=collection(db,'capital');const q=query(capitalRef,orderBy('date','desc'));const querySnapshot=await getDocs(q);const history=[];let total=0;querySnapshot.forEach(doc=>{const data={id:doc.id,...doc.data()};history.push(data);total+=Number(data.amount);});setCapitalHistory(history);setTotalCapital(total);}catch(error){console.error(\"Error fetching capital history:\",error);}};const handleAddCapital=async e=>{e.preventDefault();if(!newCapital.amount||!newCapital.date)return;try{await addDoc(collection(db,'capital'),{amount:Number(newCapital.amount),note:newCapital.note,date:newCapital.date,timestamp:new Date()});setNewCapital({amount:'',note:'',date:new Date().toISOString().split('T')[0]});await fetchCapitalHistory();}catch(error){console.error(\"Error adding capital:\",error);}};// تعديل دالة handleDeleteCapital\nconst handleDeleteCapital=async id=>{setDeleteModal({isOpen:true,itemId:id});};// إضافة دالة confirmDelete\nconst confirmDelete=async()=>{try{await deleteDoc(doc(db,'capital',deleteModal.itemId));await fetchCapitalHistory();setDeleteModal({isOpen:false,itemId:null});}catch(error){console.error(\"Error deleting capital:\",error);}};// إضافة مكون DeleteConfirmModal\nconst DeleteConfirmModal=()=>{if(!deleteModal.isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"delete-modal-overlay\",onClick:()=>setDeleteModal({isOpen:false,itemId:null}),children:/*#__PURE__*/_jsxs(\"div\",{className:\"delete-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"span\",{className:\"delete-modal-emoji\",children:\"\\uD83D\\uDDD1\\uFE0F\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"delete-modal-title\",children:\"\\u062A\\u0623\\u0643\\u064A\\u062F \\u0627\\u0644\\u062D\\u0630\\u0641\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"delete-modal-message\",children:[\"\\u0647\\u0644 \\u0623\\u0646\\u062A \\u0645\\u062A\\u0623\\u0643\\u062F \\u0645\\u0646 \\u062D\\u0630\\u0641 \\u0647\\u0630\\u0627 \\u0627\\u0644\\u0645\\u0628\\u0644\\u063A\\u061F\",/*#__PURE__*/_jsx(\"br\",{}),\"\\u0644\\u0627 \\u064A\\u0645\\u0643\\u0646 \\u0627\\u0644\\u062A\\u0631\\u0627\\u062C\\u0639 \\u0639\\u0646 \\u0647\\u0630\\u0627 \\u0627\\u0644\\u0625\\u062C\\u0631\\u0627\\u0621.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"delete-modal-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"delete-modal-btn confirm\",onClick:confirmDelete,children:\"\\u062D\\u0630\\u0641\"}),/*#__PURE__*/_jsx(\"button\",{className:\"delete-modal-btn cancel\",onClick:()=>setDeleteModal({isOpen:false,itemId:null}),children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"})]})]})});};const getFilteredCapital=()=>{if(!capitalFilter.startDate&&!capitalFilter.endDate){return capitalHistory;}return capitalHistory.filter(item=>{const itemDate=new Date(item.date);const start=capitalFilter.startDate?new Date(capitalFilter.startDate):null;const end=capitalFilter.endDate?new Date(capitalFilter.endDate):null;if(start&&end){return itemDate>=start&&itemDate<=end;}else if(start){return itemDate>=start;}else if(end){return itemDate<=end;}return true;});};const handleCustomProductAdd=async()=>{if(customProductName.trim()){try{// إضافة المنتج إلى Firestore\nconst customProductsRef=collection(db,'customProducts');const newProduct={name:customProductName.trim(),category:formData.serviceType,createdAt:new Date()};const docRef=await addDoc(customProductsRef,newProduct);// تحديث state المحلي\nsetCustomProducts(prev=>({...prev,[formData.serviceType]:[...prev[formData.serviceType],{id:docRef.id,...newProduct}]}));setCustomProductName('');setShowCustomInput(false);}catch(error){console.error(\"Error adding custom product:\",error);}}};const handleCustomProductDelete=async productId=>{try{// حذف المنتج من Firestore\nawait deleteDoc(doc(db,'customProducts',productId));// تحديث state المحلي\nsetCustomProducts(prev=>({...prev,[formData.serviceType]:prev[formData.serviceType].filter(p=>p.id!==productId)}));// إعادة تعيين القيم إذا كان المنتج المحذوف هو المحدد حالياً\nif(formData.subType===productId){setFormData({...formData,subType:'',productName:''});}}catch(error){console.error(\"Error deleting custom product:\",error);}};const handleSubTypeClick=function(subType){let customName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';// إذا تم الضغط على زر \"منتج مخصص\"\nif(subType==='custom'&&!customName){setShowCustomInput(true);// إعادة تعيين القيم عند الضغط على زر المنتج المخصص\nsetFormData({...formData,subType:'',productName:''});return;}setShowCustomInput(false);if(customName){// عند الضغط على منتج مخصص موجود\nsetFormData({...formData,subType:customName,productName:customName});}else{// للأزرار الأساسية\nsetFormData({...formData,subType,productName:subType==='crew'?'كرو':subType==='vbucks'?'فيبوكس':subType==='netflix'?'نتفلكس':subType==='shahid'?'شاهد':subType==='prime'?'برايم':subType==='promotion'?'ترويج':subType==='video'?'فيديو إعلاني':''});}};const getSubTypeButtons=()=>{switch(formData.serviceType){case'games':return/*#__PURE__*/_jsxs(\"div\",{className:\"sub-type-buttons\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='crew'?'active':''}`,onClick:()=>handleSubTypeClick('crew'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDC65\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0643\\u0631\\u0648\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='vbucks'?'active':''}`,onClick:()=>handleSubTypeClick('vbucks'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDC8E\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0641\\u064A\\u0628\\u0648\\u0643\\u0633\"})]}),customProducts.games.map(product=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn custom-product ${formData.subType===product.name?'active':''}`,onClick:()=>handleSubTypeClick('custom',product.name),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAE\"}),/*#__PURE__*/_jsx(\"span\",{children:product.name}),/*#__PURE__*/_jsx(\"span\",{className:\"delete-custom-product\",onClick:e=>{e.stopPropagation();handleCustomProductDelete(product.id);// إذا كان هذا المنتج المخصص هو المحدد حالياً، قم بإعادة تعيين الحقول\nif(formData.subType===product.name){setFormData({...formData,subType:'',productName:''});}},children:\"\\xD7\"})]},product.id)),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='custom'?'active':''}`,onClick:()=>handleSubTypeClick('custom'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2728\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0645\\u0646\\u062A\\u062C \\u0645\\u062E\\u0635\\u0635\"})]}),showCustomInput&&/*#__PURE__*/_jsxs(\"div\",{className:\"custom-product-input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:customProductName,onChange:e=>setCustomProductName(e.target.value),placeholder:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C \\u0627\\u0644\\u0645\\u062E\\u0635\\u0635\",className:\"form-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleCustomProductAdd,className:\"add-custom-btn\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629\"})]})]});case'subscriptions':return/*#__PURE__*/_jsxs(\"div\",{className:\"sub-type-buttons\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='netflix'?'active':''}`,onClick:()=>handleSubTypeClick('netflix'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAC\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0646\\u062A\\u0641\\u0644\\u0643\\u0633\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='shahid'?'active':''}`,onClick:()=>handleSubTypeClick('shahid'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCFA\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0634\\u0627\\u0647\\u062F\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='prime'?'active':''}`,onClick:()=>handleSubTypeClick('prime'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDED2\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0628\\u0631\\u0627\\u064A\\u0645\"})]}),customProducts.subscriptions.map(product=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn custom-product ${formData.subType===product.name?'active':''}`,onClick:()=>handleSubTypeClick('custom',product.name),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAF\"}),/*#__PURE__*/_jsx(\"span\",{children:product.name}),/*#__PURE__*/_jsx(\"span\",{className:\"delete-custom-product\",onClick:e=>{e.stopPropagation();handleCustomProductDelete(product.id);if(formData.subType===product.name){setFormData({...formData,subType:'',productName:''});}},children:\"\\xD7\"})]},product.id)),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='custom'?'active':''}`,onClick:()=>handleSubTypeClick('custom'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2728\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0645\\u0646\\u062A\\u062C \\u0645\\u062E\\u0635\\u0635\"})]}),showCustomInput&&/*#__PURE__*/_jsxs(\"div\",{className:\"custom-product-input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:customProductName,onChange:e=>setCustomProductName(e.target.value),placeholder:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C \\u0627\\u0644\\u0645\\u062E\\u0635\\u0635\",className:\"form-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleCustomProductAdd,className:\"add-custom-btn\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629\"})]})]});case'services':return/*#__PURE__*/_jsxs(\"div\",{className:\"sub-type-buttons\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='promotion'?'active':''}`,onClick:()=>handleSubTypeClick('promotion'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCE2\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u062A\\u0631\\u0648\\u064A\\u062C\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='video'?'active':''}`,onClick:()=>handleSubTypeClick('video'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFA5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0641\\u064A\\u062F\\u064A\\u0648 \\u0625\\u0639\\u0644\\u0627\\u0646\\u064A\"})]}),customProducts.services.map(product=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn custom-product ${formData.subType===product.name?'active':''}`,onClick:()=>handleSubTypeClick('custom',product.name),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A1\"}),/*#__PURE__*/_jsx(\"span\",{children:product.name}),/*#__PURE__*/_jsx(\"span\",{className:\"delete-custom-product\",onClick:e=>{e.stopPropagation();handleCustomProductDelete(product.id);if(formData.subType===product.name){setFormData({...formData,subType:'',productName:''});}},children:\"\\xD7\"})]},product.id)),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='custom'?'active':''}`,onClick:()=>handleSubTypeClick('custom'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2728\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0645\\u0646\\u062A\\u062C \\u0645\\u062E\\u0635\\u0635\"})]}),showCustomInput&&/*#__PURE__*/_jsxs(\"div\",{className:\"custom-product-input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:customProductName,onChange:e=>setCustomProductName(e.target.value),placeholder:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C \\u0627\\u0644\\u0645\\u062E\\u0635\\u0635\",className:\"form-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleCustomProductAdd,className:\"add-custom-btn\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629\"})]})]});default:return null;}};// إضافة هذه الدوال المساعدة المحسنة\nconst getMonthlyGrowth=history=>{if(history.length<2)return 0;const currentMonth=new Date().getMonth();const currentYear=new Date().getFullYear();const thisMonthTotal=history.filter(item=>{const date=new Date(item.date);return date.getMonth()===currentMonth&&date.getFullYear()===currentYear;}).reduce((sum,item)=>sum+Number(item.amount),0);const lastMonthTotal=history.filter(item=>{const date=new Date(item.date);return date.getMonth()===currentMonth-1&&date.getFullYear()===currentYear;}).reduce((sum,item)=>sum+Number(item.amount),0);if(lastMonthTotal===0)return 0;return((thisMonthTotal-lastMonthTotal)/lastMonthTotal*100).toFixed(1);};const getAverageAddition=history=>{if(history.length===0)return 0;const monthlyTotals={};history.forEach(item=>{const date=new Date(item.date);const monthKey=`${date.getFullYear()}-${date.getMonth()}`;monthlyTotals[monthKey]=(monthlyTotals[monthKey]||0)+Number(item.amount);});const totalMonths=Object.keys(monthlyTotals).length;const totalAmount=Object.values(monthlyTotals).reduce((sum,val)=>sum+val,0);return Math.round(totalAmount/totalMonths);};// تعديل renderCapitalSection\nconst renderCapitalSection=()=>{const filteredHistory=getFilteredCapital();const filteredTotal=filteredHistory.reduce((acc,curr)=>acc+Number(curr.amount),0);const growthRate=getMonthlyGrowth(capitalHistory);const avgAddition=getAverageAddition(capitalHistory);return/*#__PURE__*/_jsxs(\"div\",{className:\"capital-section\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"capital-header\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"section-icon\",children:\"\\uD83D\\uDCB0\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0625\\u062F\\u0627\\u0631\\u0629 \\u0648\\u062A\\u062D\\u0644\\u064A\\u0644 \\u0631\\u0623\\u0633 \\u0627\\u0644\\u0645\\u0627\\u0644\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"capital-grid\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"capital-card primary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"capital-card-content\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-wallet\"}),\"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0631\\u0623\\u0633 \\u0627\\u0644\\u0645\\u0627\\u0644\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"amount\",children:[totalCapital.toLocaleString(),/*#__PURE__*/_jsx(\"span\",{children:\"\\u062F.\\u0639\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-footer\",children:\"\\u0645\\u062C\\u0645\\u0648\\u0639 \\u0643\\u0644 \\u0627\\u0644\\u0625\\u0636\\u0627\\u0641\\u0627\\u062A\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:`capital-card ${growthRate>=0?'secondary':'danger'}`,children:/*#__PURE__*/_jsxs(\"div\",{className:\"capital-card-content\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-chart-line\"}),\"\\u0627\\u0644\\u0646\\u0645\\u0648 \\u0627\\u0644\\u0634\\u0647\\u0631\\u064A\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"amount\",children:[growthRate,/*#__PURE__*/_jsx(\"span\",{children:\"%\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-footer\",children:\"\\u0645\\u0642\\u0627\\u0631\\u0646\\u0629 \\u0628\\u0627\\u0644\\u0634\\u0647\\u0631 \\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"capital-card warning\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"capital-card-content\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-coins\"}),\"\\u0645\\u0639\\u062F\\u0644 \\u0627\\u0644\\u0625\\u0636\\u0627\\u0641\\u0627\\u062A\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"amount\",children:[avgAddition.toLocaleString(),/*#__PURE__*/_jsx(\"span\",{children:\"\\u062F.\\u0639 / \\u0634\\u0647\\u0631\\u064A\\u0627\\u064B\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-footer\",children:\"\\u0645\\u062A\\u0648\\u0633\\u0637 \\u0627\\u0644\\u0625\\u0636\\u0627\\u0641\\u0627\\u062A \\u0627\\u0644\\u0634\\u0647\\u0631\\u064A\\u0629\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"capital-form-container\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u0631\\u0623\\u0633 \\u0645\\u0627\\u0644 \\u062C\\u062F\\u064A\\u062F\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"capital-form\",onSubmit:handleAddCapital,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"capital-input-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0627\\u0644\\u0645\\u0628\\u0644\\u063A \\u0627\\u0644\\u0645\\u0636\\u0627\\u0641\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"capital-input\",value:newCapital.amount,onChange:e=>setNewCapital({...newCapital,amount:e.target.value}),placeholder:\"\\u0623\\u062F\\u062E\\u0644 \\u0627\\u0644\\u0645\\u0628\\u0644\\u063A\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"capital-input-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0627\\u0644\\u062A\\u0627\\u0631\\u064A\\u062E\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"capital-input\",value:newCapital.date,onChange:e=>setNewCapital({...newCapital,date:e.target.value}),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"capital-input-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0645\\u0644\\u0627\\u062D\\u0638\\u0627\\u062A\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"capital-input\",value:newCapital.note,onChange:e=>setNewCapital({...newCapital,note:e.target.value}),placeholder:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u0645\\u0644\\u0627\\u062D\\u0638\\u0629 (\\u0627\\u062E\\u062A\\u064A\\u0627\\u0631\\u064A)\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"capital-submit-btn\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u0631\\u0623\\u0633 \\u0645\\u0627\\u0644\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"capital-history-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0633\\u062C\\u0644 \\u0631\\u0623\\u0633 \\u0627\\u0644\\u0645\\u0627\\u0644\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"history-filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"date-filter\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0645\\u0646 \\u062A\\u0627\\u0631\\u064A\\u062E\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"capital-input\",value:capitalFilter.startDate,onChange:e=>setCapitalFilter({...capitalFilter,startDate:e.target.value})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-filter\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0625\\u0644\\u0649 \\u062A\\u0627\\u0631\\u064A\\u062E\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"capital-input\",value:capitalFilter.endDate,onChange:e=>setCapitalFilter({...capitalFilter,endDate:e.target.value})})]}),(capitalFilter.startDate||capitalFilter.endDate)&&/*#__PURE__*/_jsxs(\"div\",{className:\"filtered-total\",children:[\"\\u0627\\u0644\\u0645\\u062C\\u0645\\u0648\\u0639 \\u0627\\u0644\\u0645\\u0635\\u0641\\u0649: \",filteredTotal.toLocaleString(),\" \\u062F.\\u0639\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"history-list\",children:filteredHistory.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"history-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"history-details\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"amount-cell\",children:[Number(item.amount).toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"date-cell\",children:new Date(item.date).toLocaleDateString('ar-IQ')}),item.note&&/*#__PURE__*/_jsx(\"span\",{className:\"note-cell\",children:item.note})]}),/*#__PURE__*/_jsx(\"button\",{className:\"delete-row-btn\",onClick:()=>handleDeleteCapital(item.id),children:\"\\xD7\"})]},item.id))})]})]});};// إضافة دالة updateAnalytics\nconst updateAnalytics=ordersData=>{const analytics={totalRevenue:0,totalCost:0,totalProfit:0,profitMargin:0,ordersByType:{},revenueByType:{}};ordersData.forEach(order=>{analytics.totalRevenue+=Number(order.sellingPrice);analytics.totalCost+=Number(order.costPrice);// Update counts by type\nanalytics.ordersByType[order.serviceType]=(analytics.ordersByType[order.serviceType]||0)+1;analytics.revenueByType[order.serviceType]=(analytics.revenueByType[order.serviceType]||0)+Number(order.sellingPrice);});analytics.totalProfit=analytics.totalRevenue-analytics.totalCost;analytics.profitMargin=analytics.totalProfit/analytics.totalRevenue*100;setAnalytics(analytics);};// إضافة useEffect لجلب الطلبات\nuseEffect(()=>{const fetchOrders=async()=>{try{const querySnapshot=await getDocs(collection(db,'orders'));const ordersData=[];querySnapshot.forEach(doc=>{var _data$timestamp,_data$timestamp$toDat;const data=doc.data();// Ensure timestamp is properly handled\nconst timestamp=((_data$timestamp=data.timestamp)===null||_data$timestamp===void 0?void 0:(_data$timestamp$toDat=_data$timestamp.toDate)===null||_data$timestamp$toDat===void 0?void 0:_data$timestamp$toDat.call(_data$timestamp))||new Date();ordersData.push({id:doc.id,...data,timestamp:timestamp});});console.log('Fetched orders:',ordersData);setOrders(ordersData);updateAnalytics(ordersData);}catch(error){console.error(\"Error fetching orders:\",error);}};fetchOrders();},[]);const renderAnalyticsSection=()=>{return/*#__PURE__*/_jsxs(\"div\",{className:\"analytics-section\",children:[/*#__PURE__*/_jsx(\"header\",{className:\"analytics-header\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0644\\u0648\\u062D\\u0629 \\u0627\\u0644\\u062A\\u062D\\u0644\\u064A\\u0644\\u0627\\u062A \\u0648\\u0627\\u0644\\u0625\\u062D\\u0635\\u0627\\u0626\\u064A\\u0627\\u062A\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"analytics-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card revenue\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"icon fas fa-chart-line\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0627\\u0644\\u0625\\u064A\\u0631\\u0627\\u062F\\u0627\\u062A\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"amount\",children:[analytics.totalRevenue.toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"trend up\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-arrow-up\"}),/*#__PURE__*/_jsx(\"span\",{children:\"15% \\u0645\\u0642\\u0627\\u0631\\u0646\\u0629 \\u0628\\u0627\\u0644\\u0634\\u0647\\u0631 \\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card costs\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"icon fas fa-wallet\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0627\\u0644\\u062A\\u0643\\u0627\\u0644\\u064A\\u0641\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"amount\",children:[analytics.totalCost.toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"trend down\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-arrow-down\"}),/*#__PURE__*/_jsx(\"span\",{children:\"8% \\u0645\\u0642\\u0627\\u0631\\u0646\\u0629 \\u0628\\u0627\\u0644\\u0634\\u0647\\u0631 \\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card profit\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"icon fas fa-coins\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0635\\u0627\\u0641\\u064A \\u0627\\u0644\\u0631\\u0628\\u062D\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"amount\",children:[analytics.totalProfit.toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"trend up\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-arrow-up\"}),/*#__PURE__*/_jsx(\"span\",{children:\"20% \\u0645\\u0642\\u0627\\u0631\\u0646\\u0629 \\u0628\\u0627\\u0644\\u0634\\u0647\\u0631 \\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card margin\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"icon fas fa-percentage\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0647\\u0627\\u0645\\u0634 \\u0627\\u0644\\u0631\\u0628\\u062D\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"amount\",children:[analytics.profitMargin.toFixed(1),\"%\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"trend up\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-arrow-up\"}),/*#__PURE__*/_jsx(\"span\",{children:\"5% \\u0645\\u0642\\u0627\\u0631\\u0646\\u0629 \\u0628\\u0627\\u0644\\u0634\\u0647\\u0631 \\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"charts-container full-width\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chart-card revenue-chart\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chart-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chart-title\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"chart-icon\",children:\"\\uD83D\\uDCC8\"}),\"\\u062A\\u062D\\u0644\\u064A\\u0644 \\u0627\\u0644\\u0625\\u064A\\u0631\\u0627\\u062F\\u0627\\u062A \\u0648\\u0627\\u0644\\u062A\\u0643\\u0627\\u0644\\u064A\\u0641\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"chart-content\",children:/*#__PURE__*/_jsx(RevenueChart,{orders:orders})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chart-card distribution-chart\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"chart-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"chart-title\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"chart-icon\",children:\"\\uD83C\\uDFAF\"}),\"\\u062A\\u0648\\u0632\\u064A\\u0639 \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A \\u062D\\u0633\\u0628 \\u0627\\u0644\\u0646\\u0648\\u0639\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"chart-content\",children:/*#__PURE__*/_jsx(OrderTypesChart,{analytics:analytics,orders:orders})})]})]})]});};// تعديل renderContent لإضافة مكون DeleteConfirmModal\nconst renderContent=()=>{return/*#__PURE__*/_jsxs(_Fragment,{children:[deleteModal.isOpen&&/*#__PURE__*/_jsx(DeleteConfirmModal,{}),(()=>{switch(activeSection){case'orders':return/*#__PURE__*/_jsxs(\"div\",{className:\"orders-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"section-icon\",children:\"\\uD83D\\uDCE6\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"\\u062A\\u0633\\u062C\\u064A\\u0644 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\\u0627\\u062A \\u0648\\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"})]}),/*#__PURE__*/_jsxs(\"form\",{className:\"order-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"service-types\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`service-btn ${formData.serviceType==='games'?'active':''}`,onClick:()=>setFormData({...formData,serviceType:'games'}),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAE\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0623\\u0644\\u0639\\u0627\\u0628\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`service-btn ${formData.serviceType==='subscriptions'?'active':''}`,onClick:()=>setFormData({...formData,serviceType:'subscriptions'}),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAF\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0627\\u0634\\u062A\\u0631\\u0627\\u0643\\u0627\\u062A\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`service-btn ${formData.serviceType==='services'?'active':''}`,onClick:()=>setFormData({...formData,serviceType:'services'}),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A1\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u062E\\u062F\\u0645\\u0627\\u062A\"})]})]}),getSubTypeButtons(),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"productName\",className:\"form-input\",value:formData.productName,onChange:handleInputChange,placeholder:\"\\u0623\\u062F\\u062E\\u0644 \\u0627\\u0633\\u0645 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u062A\\u0643\\u0644\\u0641\\u0629\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"costPrice\",className:\"form-input\",value:formData.costPrice,onChange:handleInputChange,placeholder:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u062A\\u0643\\u0644\\u0641\\u0629\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0628\\u064A\\u0639\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"sellingPrice\",className:\"form-input\",value:formData.sellingPrice,onChange:handleInputChange,placeholder:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0628\\u064A\\u0639\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group description-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0648\\u0635\\u0641 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"description\",className:\"form-input\",value:formData.description,onChange:handleInputChange,placeholder:\"\\u0648\\u0635\\u0641 \\u062A\\u0641\\u0635\\u064A\\u0644\\u064A \\u0644\\u0644\\u0645\\u0646\\u062A\\u062C\",rows:\"4\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"submit-btn\",children:\"\\u062A\\u0633\\u062C\\u064A\\u0644 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"})]})]});case'capital':return renderCapitalSection();case'analytics':return renderAnalyticsSection();case'archive':return/*#__PURE__*/_jsxs(\"div\",{className:\"archive-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0623\\u0631\\u0634\\u064A\\u0641 \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"archive-filters\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\"}),/*#__PURE__*/_jsxs(\"select\",{children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"\\u0643\\u0644 \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"completed\",children:\"\\u0627\\u0644\\u0645\\u0643\\u062A\\u0645\\u0644\\u0629\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cancelled\",children:\"\\u0627\\u0644\\u0645\\u0644\\u063A\\u064A\\u0629\"})]})]})]});default:return/*#__PURE__*/_jsx(\"div\",{children:\"\\u0627\\u062E\\u062A\\u0631 \\u0642\\u0633\\u0645\\u0627\\u064B\"});}})()]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard\",children:[/*#__PURE__*/_jsx(\"nav\",{className:\"dashboard-nav\",children:Object.entries(sections).map(_ref=>{let[key,{title,icon}]=_ref;return/*#__PURE__*/_jsxs(\"button\",{className:`nav-btn ${activeSection===key?'active':''}`,onClick:()=>setActiveSection(key),children:[/*#__PURE__*/_jsx(\"span\",{children:icon}),/*#__PURE__*/_jsx(\"span\",{children:title})]},key);})}),/*#__PURE__*/_jsx(\"main\",{className:\"dashboard-content\",children:renderContent()})]});};export default Dashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}