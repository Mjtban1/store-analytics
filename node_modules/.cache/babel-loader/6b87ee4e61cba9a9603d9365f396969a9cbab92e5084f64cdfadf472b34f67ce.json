{"ast":null,"code":"import React,{useState,useEffect}from'react';import{db}from'../../firebase/config';import{collection,addDoc,getDocs,deleteDoc,doc,query,where,orderBy,onSnapshot,setDoc}from'firebase/firestore';import RevenueChart from'../Charts/RevenueChart';import OrderTypesChart from'../Charts/OrderTypesChart';import OrderDetails from'../Charts/OrderDetails';import'./Dashboard.css';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Dashboard=_ref=>{let{orders:initialOrders}=_ref;const[activeSection,setActiveSection]=useState('orders');const[showCustomInput,setShowCustomInput]=useState(false);const[customProductName,setCustomProductName]=useState('');const[customProducts,setCustomProducts]=useState({games:[],subscriptions:[],services:[]});const[formData,setFormData]=useState({productName:'',costPrice:'',sellingPrice:'',description:'',serviceType:'games',// القيمة الافتراضية\nsubType:'',// نوع المنتج الفرعي\npaymentMethod:'asiacell',// إضافة طريقة الدفع الافتراضية\ncustomerName:'',// إضافة حقل اسم العميل\ncommissionOnly:false// إضافة حقل للعمولة فقط\n});const[capitalHistory,setCapitalHistory]=useState([]);const[newCapital,setNewCapital]=useState({amount:'',note:'',date:new Date().toISOString().split('T')[0]});const[totalCapital,setTotalCapital]=useState(0);const[capitalFilter,setCapitalFilter]=useState({startDate:'',endDate:''});// إضافة حالة جديدة لإدارة نافذة التأكيد\nconst[deleteModal,setDeleteModal]=useState({isOpen:false,itemId:null,type:null});// إضافة حالة جديدة للتنبيه\nconst[insufficientModal,setInsufficientModal]=useState({isOpen:false,currentCapital:0,requiredAmount:0});const[orders,setOrders]=useState(initialOrders||[]);const[analytics,setAnalytics]=useState({totalRevenue:0,totalCost:0,totalProfit:0,profitMargin:0,ordersByType:{},revenueByType:{}});const sections={orders:{title:'تسجيل الطلبات',icon:`<img src=\"/icons/3d/orders-3d.png\" alt=\"orders\" class=\"nav-icon\" />`,activeIcon:`<img src=\"/icons/3d/orders-3d-active.png\" alt=\"orders\" class=\"nav-icon active\" />`,description:'إضافة وإدارة الطلبات الجديدة'},capital:{title:'رأس المال',icon:`<img src=\"/icons/3d/capital-3d.png\" alt=\"capital\" class=\"nav-icon\" />`,activeIcon:`<img src=\"/icons/3d/capital-3d-active.png\" alt=\"capital\" class=\"nav-icon active\" />`,description:'متابعة وإدارة رأس المال'},analytics:{title:'تحليل الطلبات',icon:`<img src=\"/icons/3d/analytics-3d.png\" alt=\"analytics\" class=\"nav-icon\" />`,activeIcon:`<img src=\"/icons/3d/analytics-3d-active.png\" alt=\"analytics\" class=\"nav-icon active\" />`,description:'تحليلات وإحصائيات الأداء'},archive:{title:'الأرشيف',icon:`<img src=\"/icons/3d/archive-3d.png\" alt=\"archive\" class=\"nav-icon\" />`,activeIcon:`<img src=\"/icons/3d/archive-3d-active.png\" alt=\"archive\" class=\"nav-icon active\" />`,description:'الطلبات المؤرشفة والسجلات'},admin:{title:'لوحة التحكم',icon:`<img src=\"/icons/3d/admin-3d.png\" alt=\"admin\" class=\"nav-icon\" />`,activeIcon:`<img src=\"/icons/3d/admin-3d-active.png\" alt=\"admin\" class=\"nav-icon active\" />`,description:'إدارة النظام والإعدادات'}};// إضافة دالة التنقل إلى لوحة التحكم\nconst navigate=useNavigate();const handleSectionClick=key=>{if(key==='admin'){navigate('/admin');}else{setActiveSection(key);}};const handleInputChange=e=>{setFormData({...formData,[e.target.name]:e.target.value});};const validateForm=()=>{var _formData$productName;return((_formData$productName=formData.productName)===null||_formData$productName===void 0?void 0:_formData$productName.trim())&&formData.costPrice&&formData.sellingPrice&&formData.serviceType&&formData.subType;};const handleSubmit=async e=>{e.preventDefault();if(!validateForm())return;try{const costPrice=formData.commissionOnly?0:Number(formData.costPrice);if(!formData.commissionOnly&&costPrice>totalCapital){setInsufficientModal({isOpen:true,currentCapital:totalCapital,requiredAmount:costPrice});return;}const orderData={...formData,timestamp:new Date(),costPrice:costPrice,sellingPrice:Number(formData.sellingPrice),profit:calculateProfit(formData.sellingPrice,costPrice,formData.paymentMethod,formData.commissionOnly),id:Date.now().toString()};const orderRef=doc(collection(db,'orders'));await setDoc(orderRef,orderData);// تحديث رأس المال مع القيمة السالبة للتكلفة\nif(!formData.commissionOnly){await updateCapital(-costPrice,'deduction','خصم تكلفة طلب جديد');}setFormData({productName:'',costPrice:'',sellingPrice:'',description:'',serviceType:'games',subType:'',paymentMethod:'asiacell',customerName:'',commissionOnly:false});showSuccessMessage('تم إضافة الطلب بنجاح');}catch(error){console.error(\"Error adding order:\",error);showErrorMessage('حدث خطأ أثناء تسجيل الطلب');}};// دالة تحديث رأس المال المحسنة\nconst updateCapital=async function(amount){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'auto';let note=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';try{if(type==='auto'){const totalCosts=amount.reduce((sum,order)=>{if(!order.isCommissionOnly){return sum+Number(order.costPrice);}return sum;},0);await fetchCapitalHistory();const availableCapital=totalCapital-totalCosts;setTotalCapital(availableCapital);}else{const capitalRef=doc(collection(db,'capital'));await setDoc(capitalRef,{amount:amount,date:new Date(),note:note||'تحديث من العمليات',type:type});await fetchCapitalHistory();}}catch(error){console.error(\"Error updating capital:\",error);throw error;}};// دالة حساب الربح\nconst calculateProfit=(sellingPrice,costPrice,paymentMethod,isCommissionOnly)=>{const selling=Number(sellingPrice);const cost=Number(costPrice);const commission=paymentMethod==='asiacell'?selling*0.10:0;if(isCommissionOnly){return commission;}return selling-cost-commission;};// إضافة useEffect لجلب المنتجات المخصصة عند تحميل المكون\nuseEffect(()=>{const fetchCustomProducts=async()=>{try{const customProductsRef=collection(db,'customProducts');const querySnapshot=await getDocs(customProductsRef);const products={games:[],subscriptions:[],services:[]};querySnapshot.forEach(doc=>{const product={id:doc.id,...doc.data()};products[product.category].push(product);});setCustomProducts(products);}catch(error){console.error(\"Error fetching custom products:\",error);}};fetchCustomProducts();},[]);useEffect(()=>{fetchCapitalHistory();},[]);const fetchCapitalHistory=async()=>{try{const capitalRef=collection(db,'capital');const q=query(capitalRef,orderBy('date','desc'));const querySnapshot=await getDocs(q);const history=[];let total=0;querySnapshot.forEach(doc=>{const data={id:doc.id,...doc.data()};history.push(data);total+=Number(data.amount);});setCapitalHistory(history);setTotalCapital(total);}catch(error){console.error(\"Error fetching capital history:\",error);}};const handleAddCapital=async e=>{e.preventDefault();if(!newCapital.amount||!newCapital.date)return;try{await addDoc(collection(db,'capital'),{amount:Number(newCapital.amount),note:newCapital.note,date:newCapital.date,timestamp:new Date()});setNewCapital({amount:'',note:'',date:new Date().toISOString().split('T')[0]});await fetchCapitalHistory();}catch(error){console.error(\"Error adding capital:\",error);}};// تعديل دالة handleDeleteCapital\nconst handleDeleteCapital=async id=>{setDeleteModal({isOpen:true,itemId:id,type:'capital'// إضافة نوع العنصر المراد حذفه\n});};// إضافة دالة confirmDelete\nconst confirmDelete=async()=>{try{const capitalRef=doc(collection(db,'capital'));await deleteDoc(capitalRef);await updateCapital(deleteModal.itemId,'deletion','استرجاع من حذف طلب');setDeleteModal({isOpen:false,itemId:null,type:null});await fetchCapitalHistory();showSuccessMessage('تم الحذف بنجاح');}catch(error){console.error(\"Error in delete operation:\",error);showErrorMessage('حدث خطأ أثناء الحذف');}};// تعديل مكون DeleteConfirmModal\nconst DeleteConfirmModal=()=>{if(!deleteModal.isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"delete-modal-overlay\",onClick:()=>setDeleteModal({isOpen:false,itemId:null,type:null}),children:/*#__PURE__*/_jsxs(\"div\",{className:\"delete-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"div\",{className:\"delete-modal-icon\",children:\"\\uD83D\\uDDD1\\uFE0F\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"delete-modal-title\",children:\"\\u062A\\u0623\\u0643\\u064A\\u062F \\u0627\\u0644\\u062D\\u0630\\u0641\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"delete-modal-message\",children:[deleteModal.type==='capital'?'هل أنت متأكد من حذف هذا المبلغ من سجل رأس المال؟':'هل أنت متأكد من حذف هذا العنصر؟',/*#__PURE__*/_jsx(\"br\",{}),\"\\u0644\\u0627 \\u064A\\u0645\\u0643\\u0646 \\u0627\\u0644\\u062A\\u0631\\u0627\\u062C\\u0639 \\u0639\\u0646 \\u0647\\u0630\\u0627 \\u0627\\u0644\\u0625\\u062C\\u0631\\u0627\\u0621.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"delete-modal-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"delete-modal-btn confirm\",onClick:confirmDelete,children:\"\\u0646\\u0639\\u0645\\u060C \\u0627\\u062D\\u0630\\u0641\"}),/*#__PURE__*/_jsx(\"button\",{className:\"delete-modal-btn cancel\",onClick:()=>setDeleteModal({isOpen:false,itemId:null,type:null}),children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"})]})]})});};// إضافة مكون نافذة التنبيه\nconst InsufficientFundsModal=()=>{if(!insufficientModal.isOpen)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"insufficient-modal-overlay\",onClick:()=>setInsufficientModal({...insufficientModal,isOpen:false}),children:/*#__PURE__*/_jsxs(\"div\",{className:\"insufficient-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"div\",{className:\"insufficient-modal-icon\",children:insufficientModal.currentCapital<=0?'💸':'⚠️'}),/*#__PURE__*/_jsx(\"h3\",{className:\"insufficient-modal-title\",children:insufficientModal.currentCapital<=0?'لا يوجد رأس مال':'رأس المال غير كافي'}),/*#__PURE__*/_jsx(\"div\",{className:\"insufficient-modal-content\",children:/*#__PURE__*/_jsx(\"p\",{children:insufficientModal.currentCapital<=0?'لا يمكن إضافة الطلب. يرجى إضافة رأس مال أولاً.':`تكلفة الطلب (${insufficientModal.requiredAmount.toLocaleString()} د.ع) تتجاوز رأس المال المتوفر (${insufficientModal.currentCapital.toLocaleString()} د.ع)`})}),/*#__PURE__*/_jsxs(\"div\",{className:\"insufficient-modal-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"add-capital-btn\",onClick:()=>{setActiveSection('capital');setInsufficientModal({...insufficientModal,isOpen:false});},children:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u0631\\u0623\\u0633 \\u0645\\u0627\\u0644\"}),/*#__PURE__*/_jsx(\"button\",{className:\"cancel-btn\",onClick:()=>setInsufficientModal({...insufficientModal,isOpen:false}),children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"})]})]})});};const getFilteredCapital=()=>{if(!capitalFilter.startDate&&!capitalFilter.endDate){return capitalHistory;}return capitalHistory.filter(item=>{const itemDate=new Date(item.date);const start=capitalFilter.startDate?new Date(capitalFilter.startDate):null;const end=capitalFilter.endDate?new Date(capitalFilter.endDate):null;if(start&&end){return itemDate>=start&&itemDate<=end;}else if(start){return itemDate>=start;}else if(end){return itemDate<=end;}return true;});};const handleCustomProductAdd=async()=>{if(customProductName.trim()){try{// إضافة المنتج إلى Firestore\nconst customProductsRef=collection(db,'customProducts');const newProduct={name:customProductName.trim(),category:formData.serviceType,createdAt:new Date()};const docRef=await addDoc(customProductsRef,newProduct);// تحديث state المحلي\nsetCustomProducts(prev=>({...prev,[formData.serviceType]:[...prev[formData.serviceType],{id:docRef.id,...newProduct}]}));setCustomProductName('');setShowCustomInput(false);}catch(error){console.error(\"Error adding custom product:\",error);}}};const handleCustomProductDelete=async productId=>{try{// حذف المنتج من Firestore\nawait deleteDoc(doc(db,'customProducts',productId));// تحديث state المحلي\nsetCustomProducts(prev=>({...prev,[formData.serviceType]:prev[formData.serviceType].filter(p=>p.id!==productId)}));// إعادة تعيين القيم إذا كان المنتج المحذوف هو المحدد حالياً\nif(formData.subType===productId){setFormData({...formData,subType:'',productName:''});}}catch(error){console.error(\"Error deleting custom product:\",error);}};const handleSubTypeClick=function(subType){let customName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'';// إذا تم الضغط على زر \"منتج مخصص\"\nif(subType==='custom'&&!customName){setShowCustomInput(true);// إعادة تعيين القيم عند الضغط على زر المنتج المخصص\nsetFormData({...formData,subType:'',productName:''});return;}setShowCustomInput(false);if(customName){// عند الضغط على منتج مخصص موجود\nsetFormData({...formData,subType:customName,productName:customName});}else{// للأزرار الأساسية\nsetFormData({...formData,subType,productName:subType==='crew'?'كرو':subType==='vbucks'?'فيبوكس':subType==='netflix'?'نتفلكس':subType==='shahid'?'شاهد':subType==='prime'?'برايم':subType==='promotion'?'ترويج':subType==='video'?'فيديو إعلاني':''});}};const getSubTypeButtons=()=>{switch(formData.serviceType){case'games':return/*#__PURE__*/_jsxs(\"div\",{className:\"sub-type-buttons\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='crew'?'active':''}`,onClick:()=>handleSubTypeClick('crew'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDC65\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0643\\u0631\\u0648\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='vbucks'?'active':''}`,onClick:()=>handleSubTypeClick('vbucks'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDC8E\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0641\\u064A\\u0628\\u0648\\u0643\\u0633\"})]}),customProducts.games.map(product=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn custom-product ${formData.subType===product.name?'active':''}`,onClick:()=>handleSubTypeClick('custom',product.name),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAE\"}),/*#__PURE__*/_jsx(\"span\",{children:product.name}),/*#__PURE__*/_jsx(\"span\",{className:\"delete-custom-product\",onClick:e=>{e.stopPropagation();handleCustomProductDelete(product.id);// إذا كان هذا المنتج المخصص هو المحدد حالياً، قم بإعادة تعيين الحقول\nif(formData.subType===product.name){setFormData({...formData,subType:'',productName:''});}},children:\"\\xD7\"})]},product.id)),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='custom'?'active':''}`,onClick:()=>handleSubTypeClick('custom'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2728\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0645\\u0646\\u062A\\u062C \\u0645\\u062E\\u0635\\u0635\"})]}),showCustomInput&&/*#__PURE__*/_jsxs(\"div\",{className:\"custom-product-input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:customProductName,onChange:e=>setCustomProductName(e.target.value),placeholder:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C \\u0627\\u0644\\u0645\\u062E\\u0635\\u0635\",className:\"form-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleCustomProductAdd,className:\"add-custom-btn\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629\"})]})]});case'subscriptions':return/*#__PURE__*/_jsxs(\"div\",{className:\"sub-type-buttons\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='netflix'?'active':''}`,onClick:()=>handleSubTypeClick('netflix'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAC\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0646\\u062A\\u0641\\u0644\\u0643\\u0633\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='shahid'?'active':''}`,onClick:()=>handleSubTypeClick('shahid'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCFA\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0634\\u0627\\u0647\\u062F\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='prime'?'active':''}`,onClick:()=>handleSubTypeClick('prime'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDED2\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0628\\u0631\\u0627\\u064A\\u0645\"})]}),customProducts.subscriptions.map(product=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn custom-product ${formData.subType===product.name?'active':''}`,onClick:()=>handleSubTypeClick('custom',product.name),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAF\"}),/*#__PURE__*/_jsx(\"span\",{children:product.name}),/*#__PURE__*/_jsx(\"span\",{className:\"delete-custom-product\",onClick:e=>{e.stopPropagation();handleCustomProductDelete(product.id);if(formData.subType===product.name){setFormData({...formData,subType:'',productName:''});}},children:\"\\xD7\"})]},product.id)),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='custom'?'active':''}`,onClick:()=>handleSubTypeClick('custom'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2728\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0645\\u0646\\u062A\\u062C \\u0645\\u062E\\u0635\\u0635\"})]}),showCustomInput&&/*#__PURE__*/_jsxs(\"div\",{className:\"custom-product-input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:customProductName,onChange:e=>setCustomProductName(e.target.value),placeholder:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C \\u0627\\u0644\\u0645\\u062E\\u0635\\u0635\",className:\"form-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleCustomProductAdd,className:\"add-custom-btn\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629\"})]})]});case'services':return/*#__PURE__*/_jsxs(\"div\",{className:\"sub-type-buttons\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='promotion'?'active':''}`,onClick:()=>handleSubTypeClick('promotion'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCE2\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u062A\\u0631\\u0648\\u064A\\u062C\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='video'?'active':''}`,onClick:()=>handleSubTypeClick('video'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFA5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0641\\u064A\\u062F\\u064A\\u0648 \\u0625\\u0639\\u0644\\u0627\\u0646\\u064A\"})]}),customProducts.services.map(product=>/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn custom-product ${formData.subType===product.name?'active':''}`,onClick:()=>handleSubTypeClick('custom',product.name),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A1\"}),/*#__PURE__*/_jsx(\"span\",{children:product.name}),/*#__PURE__*/_jsx(\"span\",{className:\"delete-custom-product\",onClick:e=>{e.stopPropagation();handleCustomProductDelete(product.id);if(formData.subType===product.name){setFormData({...formData,subType:'',productName:''});}},children:\"\\xD7\"})]},product.id)),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`sub-type-btn ${formData.subType==='custom'?'active':''}`,onClick:()=>handleSubTypeClick('custom'),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2728\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0645\\u0646\\u062A\\u062C \\u0645\\u062E\\u0635\\u0635\"})]}),showCustomInput&&/*#__PURE__*/_jsxs(\"div\",{className:\"custom-product-input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:customProductName,onChange:e=>setCustomProductName(e.target.value),placeholder:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C \\u0627\\u0644\\u0645\\u062E\\u0635\\u0635\",className:\"form-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleCustomProductAdd,className:\"add-custom-btn\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629\"})]})]});default:return null;}};// إضافة هذه الدوال المساعدة المحسنة\nconst getMonthlyGrowth=history=>{if(history.length<2)return 0;const currentMonth=new Date().getMonth();const currentYear=new Date().getFullYear();const thisMonthTotal=history.filter(item=>{const date=new Date(item.date);return date.getMonth()===currentMonth&&date.getFullYear()===currentYear;}).reduce((sum,item)=>sum+Number(item.amount),0);const lastMonthTotal=history.filter(item=>{const date=new Date(item.date);return date.getMonth()===currentMonth-1&&date.getFullYear()===currentYear;}).reduce((sum,item)=>sum+Number(item.amount),0);if(lastMonthTotal===0)return 0;return((thisMonthTotal-lastMonthTotal)/lastMonthTotal*100).toFixed(1);};const getAverageAddition=history=>{if(history.length===0)return 0;const monthlyTotals={};history.forEach(item=>{const date=new Date(item.date);const monthKey=`${date.getFullYear()}-${date.getMonth()}`;monthlyTotals[monthKey]=(monthlyTotals[monthKey]||0)+Number(item.amount);});const totalMonths=Object.keys(monthlyTotals).length;const totalAmount=Object.values(monthlyTotals).reduce((sum,val)=>sum+val,0);return Math.round(totalAmount/totalMonths);};// تعديل renderCapitalSection\nconst renderCapitalSection=()=>{const filteredHistory=getFilteredCapital();const filteredTotal=filteredHistory.reduce((acc,curr)=>acc+Number(curr.amount),0);const growthRate=getMonthlyGrowth(capitalHistory);const avgAddition=getAverageAddition(capitalHistory);return/*#__PURE__*/_jsxs(\"div\",{className:\"capital-section\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"capital-header\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"section-icon\",children:\"\\uD83D\\uDCB0\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0625\\u062F\\u0627\\u0631\\u0629 \\u0648\\u062A\\u062D\\u0644\\u064A\\u0644 \\u0631\\u0623\\u0633 \\u0627\\u0644\\u0645\\u0627\\u0644\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"capital-grid\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"capital-card primary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"capital-card-content\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-wallet\"}),\"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0631\\u0623\\u0633 \\u0627\\u0644\\u0645\\u0627\\u0644\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"amount\",children:[totalCapital.toLocaleString(),/*#__PURE__*/_jsx(\"span\",{children:\"\\u062F.\\u0639\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-footer\",children:\"\\u0645\\u062C\\u0645\\u0648\\u0639 \\u0643\\u0644 \\u0627\\u0644\\u0625\\u0636\\u0627\\u0641\\u0627\\u062A\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:`capital-card ${growthRate>=0?'secondary':'danger'}`,children:/*#__PURE__*/_jsxs(\"div\",{className:\"capital-card-content\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-chart-line\"}),\"\\u0627\\u0644\\u0646\\u0645\\u0648 \\u0627\\u0644\\u0634\\u0647\\u0631\\u064A\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"amount\",children:[growthRate,/*#__PURE__*/_jsx(\"span\",{children:\"%\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-footer\",children:\"\\u0645\\u0642\\u0627\\u0631\\u0646\\u0629 \\u0628\\u0627\\u0644\\u0634\\u0647\\u0631 \\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"capital-card warning\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"capital-card-content\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-coins\"}),\"\\u0645\\u0639\\u062F\\u0644 \\u0627\\u0644\\u0625\\u0636\\u0627\\u0641\\u0627\\u062A\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"amount\",children:[avgAddition.toLocaleString(),/*#__PURE__*/_jsx(\"span\",{children:\"\\u062F.\\u0639 / \\u0634\\u0647\\u0631\\u064A\\u0627\\u064B\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-footer\",children:\"\\u0645\\u062A\\u0648\\u0633\\u0637 \\u0627\\u0644\\u0625\\u0636\\u0627\\u0641\\u0627\\u062A \\u0627\\u0644\\u0634\\u0647\\u0631\\u064A\\u0629\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"capital-form-container\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u0631\\u0623\\u0633 \\u0645\\u0627\\u0644 \\u062C\\u062F\\u064A\\u062F\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"capital-form\",onSubmit:handleAddCapital,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"capital-input-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0627\\u0644\\u0645\\u0628\\u0644\\u063A \\u0627\\u0644\\u0645\\u0636\\u0627\\u0641\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"capital-input\",value:newCapital.amount,onChange:e=>setNewCapital({...newCapital,amount:e.target.value}),placeholder:\"\\u0623\\u062F\\u062E\\u0644 \\u0627\\u0644\\u0645\\u0628\\u0644\\u063A\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"capital-input-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0627\\u0644\\u062A\\u0627\\u0631\\u064A\\u062E\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"capital-input\",value:newCapital.date,onChange:e=>setNewCapital({...newCapital,date:e.target.value}),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"capital-input-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0645\\u0644\\u0627\\u062D\\u0638\\u0627\\u062A\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"capital-input\",value:newCapital.note,onChange:e=>setNewCapital({...newCapital,note:e.target.value}),placeholder:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u0645\\u0644\\u0627\\u062D\\u0638\\u0629 (\\u0627\\u062E\\u062A\\u064A\\u0627\\u0631\\u064A)\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"capital-submit-btn\",children:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u0631\\u0623\\u0633 \\u0645\\u0627\\u0644\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"capital-history-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0633\\u062C\\u0644 \\u0631\\u0623\\u0633 \\u0627\\u0644\\u0645\\u0627\\u0644\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"history-filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"date-filter\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0645\\u0646 \\u062A\\u0627\\u0631\\u064A\\u062E\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"capital-input\",value:capitalFilter.startDate,onChange:e=>setCapitalFilter({...capitalFilter,startDate:e.target.value})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-filter\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0625\\u0644\\u0649 \\u062A\\u0627\\u0631\\u064A\\u062E\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"capital-input\",value:capitalFilter.endDate,onChange:e=>setCapitalFilter({...capitalFilter,endDate:e.target.value})})]}),(capitalFilter.startDate||capitalFilter.endDate)&&/*#__PURE__*/_jsxs(\"div\",{className:\"filtered-total\",children:[\"\\u0627\\u0644\\u0645\\u062C\\u0645\\u0648\\u0639 \\u0627\\u0644\\u0645\\u0635\\u0641\\u0649: \",filteredTotal.toLocaleString(),\" \\u062F.\\u0639\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"history-list\",children:filteredHistory.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"history-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"history-details\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"amount-cell\",children:[Number(item.amount).toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"date-cell\",children:new Date(item.date).toLocaleDateString('ar-IQ')}),item.note&&/*#__PURE__*/_jsx(\"span\",{className:\"note-cell\",children:item.note})]}),/*#__PURE__*/_jsx(\"button\",{className:\"delete-row-btn\",onClick:()=>handleDeleteCapital(item.id),title:\"\\u062D\\u0630\\u0641\",children:\"\\xD7\"})]},item.id))})]})]});};// إضافة دالة updateAnalytics\nconst updateAnalytics=updatedOrders=>{const analytics={totalRevenue:0,totalCost:0,totalProfit:0,profitMargin:0,ordersByType:{},revenueByType:{}};updatedOrders.forEach(order=>{const revenue=Number(order.sellingPrice);const cost=Number(order.costPrice);const commission=order.paymentMethod==='asiacell'?revenue*0.10:0;const profit=revenue-cost-commission;analytics.totalRevenue+=revenue;analytics.totalCost+=cost;analytics.totalProfit+=profit;// تحديث التصنيف حسب النوع\nanalytics.ordersByType[order.serviceType]=(analytics.ordersByType[order.serviceType]||0)+1;analytics.revenueByType[order.serviceType]=(analytics.revenueByType[order.serviceType]||0)+revenue;});if(analytics.totalRevenue>0){analytics.profitMargin=analytics.totalProfit/analytics.totalRevenue*100;}setAnalytics(analytics);};// إضافة useEffect لجلب الطلبات\nuseEffect(()=>{const fetchOrders=async()=>{try{if(!initialOrders){const querySnapshot=await getDocs(collection(db,'orders'));const ordersData=querySnapshot.docs.map(doc=>{var _doc$data$timestamp,_doc$data$timestamp$t;return{id:doc.id,...doc.data(),timestamp:((_doc$data$timestamp=doc.data().timestamp)===null||_doc$data$timestamp===void 0?void 0:(_doc$data$timestamp$t=_doc$data$timestamp.toDate)===null||_doc$data$timestamp$t===void 0?void 0:_doc$data$timestamp$t.call(_doc$data$timestamp))||new Date()};});setOrders(ordersData);updateAnalytics(ordersData);}else{updateAnalytics(initialOrders);}}catch(error){console.error(\"Error fetching orders:\",error);}};fetchOrders();},[initialOrders]);// إضافة دالة renderAnalyticsStats\nconst renderAnalyticsStats=()=>{const totalRevenue=orders.reduce((sum,order)=>sum+Number(order.sellingPrice),0);const totalCosts=orders.reduce((sum,order)=>sum+Number(order.costPrice),0);const profit=totalRevenue-totalCosts;const profitMargin=totalRevenue>0?(profit/totalRevenue*100).toFixed(1):0;const averageOrderValue=orders.length>0?(totalRevenue/orders.length).toFixed(0):0;const statCards=[{title:'إجمالي الإيرادات',value:`${totalRevenue.toLocaleString()} د.ع`,icon:'💰',color:'#4CAF50',gradient:'linear-gradient(135deg, #4CAF50, #45a049)'},{title:'إجمالي التكاليف',value:`${totalCosts.toLocaleString()} د.ع`,icon:'💳',color:'#f44336',gradient:'linear-gradient(135deg, #f44336, #e53935)'},{title:'صافي الربح',value:`${profit.toLocaleString()} د.ع`,icon:'📈',color:'#2196F3',gradient:'linear-gradient(135deg, #2196F3, #1976D2)'},{title:'هامش الربح',value:`${profitMargin}%`,icon:'📊',color:'#FF9800',gradient:'linear-gradient(135deg, #FF9800, #F57C00)'}];return/*#__PURE__*/_jsx(\"div\",{className:\"analytics-stats\",style:{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(240px, 1fr))',gap:'20px',margin:'20px 0',padding:'0 10px'},children:statCards.map((card,index)=>/*#__PURE__*/_jsxs(\"div\",{style:{background:card.gradient,borderRadius:'15px',padding:'20px',color:'white',display:'flex',flexDirection:'column',gap:'10px',boxShadow:'0 4px 15px rgba(0,0,0,0.1)',transition:'transform 0.3s ease',cursor:'pointer',minHeight:'150px',position:'relative',overflow:'hidden'},children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:'10px',left:'10px',fontSize:'2rem',opacity:'0.2'},children:card.icon}),/*#__PURE__*/_jsx(\"h3\",{style:{margin:'0',fontSize:'1rem',opacity:'0.9'},children:card.title}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'1.8rem',fontWeight:'bold',marginTop:'auto'},children:card.value})]},index))});};// تحديث دالة renderAnalyticsSection لاستخدام الدالة الجديدة\nconst renderAnalyticsSection=()=>{if(activeSection!=='analytics')return null;const totalRevenue=(orders===null||orders===void 0?void 0:orders.reduce((sum,order)=>sum+Number(order.sellingPrice),0))||0;const totalCosts=(orders===null||orders===void 0?void 0:orders.reduce((sum,order)=>sum+Number(order.costPrice),0))||0;const profit=totalRevenue-totalCosts;const profitMargin=totalRevenue>0?(profit/totalRevenue*100).toFixed(1):0;const statCards=[{title:'إجمالي الإيرادات',value:`${totalRevenue.toLocaleString()} د.ع`,mainIcon:'💰',subIcons:['💵','💎','💰'],gradient:'linear-gradient(135deg, #22c55e, #16a34a)',growthRate:'+12.5%',isPositive:true,glowColor:'rgba(34, 197, 94, 0.5)'// إضافة لون التوهج\n},{title:'إجمالي التكاليف',value:`${totalCosts.toLocaleString()} د.ع`,mainIcon:'💳',subIcons:['💸','📊','💱'],gradient:'linear-gradient(135deg, #ef4444, #dc2626)',growthRate:'-8.3%',isPositive:false,glowColor:'rgba(239, 68, 68, 0.5)'},{title:'صافي الربح',value:`${profit.toLocaleString()} د.ع`,mainIcon:'📈',subIcons:['⭐','✨','💫'],gradient:'linear-gradient(135deg, #3b82f6, #2563eb)',growthRate:'+15.2%',isPositive:true,glowColor:'rgba(59, 130, 246, 0.5)'},{title:'هامش الربح',value:`${profitMargin}%`,mainIcon:'📊',subIcons:['📈','💹','📊'],gradient:'linear-gradient(135deg, #f59e0b, #d97706)',growthRate:'+5.7%',isPositive:true,glowColor:'rgba(245, 158, 11, 0.5)'}];return/*#__PURE__*/_jsxs(\"div\",{className:\"analytics-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"analytics-stats\",children:statCards.map((card,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",style:{background:card.gradient,position:'relative',overflow:'hidden',boxShadow:`0 8px 32px ${card.glowColor}`,backdropFilter:'blur(5px)',WebkitBackdropFilter:'blur(5px)'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-pattern\"}),card.subIcons.map((icon,i)=>/*#__PURE__*/_jsx(\"span\",{className:`floating-icon icon-${i}`,children:icon},i)),/*#__PURE__*/_jsx(\"div\",{className:\"main-icon\",children:card.mainIcon}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-content\",children:[/*#__PURE__*/_jsx(\"h3\",{style:{color:'rgba(255, 255, 255, 0.95)',fontWeight:'500'},children:card.title}),/*#__PURE__*/_jsx(\"div\",{className:\"card-value\",style:{color:'white',textShadow:'0 2px 4px rgba(0,0,0,0.1)',fontSize:'2rem',fontWeight:'700'},children:card.value}),/*#__PURE__*/_jsxs(\"div\",{className:`card-growth ${card.isPositive?'positive':'negative'}`,style:{color:'white'},children:[/*#__PURE__*/_jsx(\"span\",{className:\"growth-icon\",children:card.isPositive?'↗':'↘'}),/*#__PURE__*/_jsx(\"span\",{className:\"growth-text\",style:{fontWeight:'600'},children:card.growthRate}),/*#__PURE__*/_jsx(\"span\",{className:\"growth-period\",style:{color:'rgba(255, 255, 255, 0.8)'},children:\"\\u0645\\u0642\\u0627\\u0631\\u0646\\u0629 \\u0628\\u0627\\u0644\\u0634\\u0647\\u0631 \\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"})]})]})]},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"charts-container\",children:[/*#__PURE__*/_jsx(RevenueChart,{orders:orders}),/*#__PURE__*/_jsx(OrderTypesChart,{orders:orders})]}),/*#__PURE__*/_jsx(OrderDetails,{orders:orders,onUpdateOrder:handleOrderUpdate})]});};const renderContent=()=>{switch(activeSection){case'orders':return/*#__PURE__*/_jsxs(\"div\",{className:\"orders-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"section-icon\",children:\"\\uD83D\\uDCE6\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"\\u062A\\u0633\\u062C\\u064A\\u0644 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\\u0627\\u062A \\u0648\\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"})]}),/*#__PURE__*/_jsxs(\"form\",{className:\"order-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"service-types\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`service-btn ${formData.serviceType==='games'?'active':''}`,onClick:()=>setFormData({...formData,serviceType:'games'}),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAE\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0623\\u0644\\u0639\\u0627\\u0628\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`service-btn ${formData.serviceType==='subscriptions'?'active':''}`,onClick:()=>setFormData({...formData,serviceType:'subscriptions'}),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAF\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0627\\u0634\\u062A\\u0631\\u0627\\u0643\\u0627\\u062A\"})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:`service-btn ${formData.serviceType==='services'?'active':''}`,onClick:()=>setFormData({...formData,serviceType:'services'}),children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A1\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u062E\\u062F\\u0645\\u0627\\u062A\"})]})]}),getSubTypeButtons(),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"productName\",className:\"form-input\",value:formData.productName,onChange:handleInputChange,placeholder:\"\\u0623\\u062F\\u062E\\u0644 \\u0627\\u0633\\u0645 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u062A\\u0643\\u0644\\u0641\\u0629\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"costPrice\",className:\"form-input\",value:formData.costPrice,onChange:handleInputChange,placeholder:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u062A\\u0643\\u0644\\u0641\\u0629\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0628\\u064A\\u0639\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"sellingPrice\",className:\"form-input\",value:formData.sellingPrice,onChange:handleInputChange,placeholder:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0628\\u064A\\u0639\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0648\\u0635\\u0641 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"description\",className:\"form-input\",value:formData.description,onChange:handleInputChange,placeholder:\"\\u0648\\u0635\\u0641 \\u062A\\u0641\\u0635\\u064A\\u0644\\u064A \\u0644\\u0644\\u0645\\u0646\\u062A\\u062C\",rows:\"4\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0639\\u0645\\u064A\\u0644\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"customerName\",className:\"form-input\",value:formData.customerName,onChange:handleInputChange,placeholder:\"\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0639\\u0645\\u064A\\u0644\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group payment-section\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0637\\u0631\\u064A\\u0642\\u0629 \\u0627\\u0644\\u062F\\u0641\\u0639\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"paymentMethod\",className:\"form-input\",value:formData.paymentMethod,onChange:handleInputChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"asiacell\",children:\"\\u0622\\u0633\\u064A\\u0627\\u0633\\u064A\\u0644\"}),/*#__PURE__*/_jsx(\"option\",{value:\"zain\",children:\"\\u0632\\u064A\\u0646 \\u0643\\u0627\\u0634\"}),/*#__PURE__*/_jsx(\"option\",{value:\"rafidain\",children:\"\\u0627\\u0644\\u0631\\u0627\\u0641\\u062F\\u064A\\u0646\"}),/*#__PURE__*/_jsx(\"option\",{value:\"crypto\",children:\"\\u0643\\u0631\\u0628\\u062A\\u0648\"})]}),formData.paymentMethod==='asiacell'&&/*#__PURE__*/_jsx(\"div\",{className:\"commission-option\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"checkbox-label\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",name:\"commissionOnly\",checked:formData.commissionOnly,onChange:e=>setFormData({...formData,commissionOnly:e.target.checked,costPrice:e.target.checked?'0':formData.costPrice})}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0639\\u0645\\u0648\\u0644\\u0629 \\u0641\\u0642\\u0637 (10%)\"})]})})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"submit-btn\",children:\"\\u062A\\u0633\\u062C\\u064A\\u0644 \\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"})]})]});case'capital':return renderCapitalSection();case'analytics':return renderAnalyticsSection();case'archive':return/*#__PURE__*/_jsxs(\"div\",{className:\"archive-section\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0623\\u0631\\u0634\\u064A\\u0641 \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"archive-filters\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\"}),/*#__PURE__*/_jsxs(\"select\",{children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"\\u0643\\u0644 \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"completed\",children:\"\\u0627\\u0644\\u0645\\u0643\\u062A\\u0645\\u0644\\u0629\"}),/*#__PURE__*/_jsx(\"option\",{value:\"cancelled\",children:\"\\u0627\\u0644\\u0645\\u0644\\u063A\\u064A\\u0629\"})]})]})]});default:return/*#__PURE__*/_jsx(\"div\",{children:\"\\u0627\\u062E\\u062A\\u0631 \\u0642\\u0633\\u0645\\u0627\\u064B\"});}};// إضافة مراقب للتغييرات في الطلبات\nuseEffect(()=>{const ordersQuery=query(collection(db,'orders'));const unsubscribe=onSnapshot(ordersQuery,snapshot=>{const updatedOrders=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setOrders(updatedOrders);updateAnalytics(updatedOrders);updateCapital(updatedOrders);},error=>{console.error(\"Error listening to orders:\",error);});return()=>unsubscribe();},[]);// إضافة دالة تحديث الطلبات\nconst handleOrderUpdate=(orderId,updatedData)=>{setOrders(prevOrders=>{if(!updatedData){// إذا كان updatedData هو null، فهذا يعني حذف الطلب\nreturn prevOrders.filter(order=>order.id!==orderId);}// تحديث الطلب\nreturn prevOrders.map(order=>order.id===orderId?{...order,...updatedData}:order);});};return/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard\",children:[/*#__PURE__*/_jsx(\"nav\",{className:\"dashboard-nav\",children:Object.entries(sections).map(_ref2=>{let[key,{title,icon,activeIcon,description}]=_ref2;return/*#__PURE__*/_jsxs(\"button\",{className:`nav-btn ${activeSection===key?'active':''}`,onClick:()=>handleSectionClick(key),title:description,children:[/*#__PURE__*/_jsx(\"span\",{className:\"icon-container\",dangerouslySetInnerHTML:{__html:activeSection===key?activeIcon:icon}}),/*#__PURE__*/_jsx(\"span\",{className:\"nav-title\",children:title})]},key);})}),/*#__PURE__*/_jsx(\"main\",{className:\"dashboard-content\",children:renderContent()}),/*#__PURE__*/_jsx(InsufficientFundsModal,{}),/*#__PURE__*/_jsx(DeleteConfirmModal,{})]});};export default Dashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}