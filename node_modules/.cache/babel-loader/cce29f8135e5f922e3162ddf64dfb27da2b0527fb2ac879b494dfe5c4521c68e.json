{"ast":null,"code":"import React,{useState,useEffect}from'react';import{db}from'../../firebase/config';import{collection,getDocs,deleteDoc,doc,updateDoc,setDoc}from'firebase/firestore';import'./AdminPanel.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminPanel=()=>{const[isAuthenticated,setIsAuthenticated]=useState(false);const[password,setPassword]=useState('');const[error,setError]=useState('');const[data,setData]=useState({orders:[],capital:[]});const[loading,setLoading]=useState(true);const[activeTab,setActiveTab]=useState('orders');const[users,setUsers]=useState([]);const[editingUser,setEditingUser]=useState(null);const handleLogin=e=>{e.preventDefault();if(password==='MJ'){setIsAuthenticated(true);setError('');fetchData();}else{setError('رمز الدخول غير صحيح');}};const fetchData=async()=>{try{const[ordersSnapshot,capitalSnapshot,usersSnapshot]=await Promise.all([getDocs(collection(db,'orders')),getDocs(collection(db,'capital')),getDocs(collection(db,'users'))]);setData({orders:ordersSnapshot.docs.map(doc=>({id:doc.id,...doc.data()})),capital:capitalSnapshot.docs.map(doc=>({id:doc.id,...doc.data()}))});setUsers(usersSnapshot.docs.map(doc=>({id:doc.id,...doc.data()})));setLoading(false);}catch(error){console.error('Error fetching data:',error);setLoading(false);}};const handleDelete=async(id,collection)=>{if(window.confirm('هل أنت متأكد من حذف هذا العنصر؟')){try{await deleteDoc(doc(db,collection,id));await fetchData();// إعادة تحميل البيانات\n}catch(error){console.error('Error deleting document:',error);}}};const handleUpdateUser=async(userId,userData)=>{try{await updateDoc(doc(db,'users',userId),userData);await fetchData();setEditingUser(null);}catch(error){console.error('Error updating user:',error);}};const handleAddUser=async userData=>{try{const newUserRef=doc(collection(db,'users'));await setDoc(newUserRef,{...userData,createdAt:new Date()});await fetchData();}catch(error){console.error('Error adding user:',error);}};const UserForm=_ref=>{let{user,onSubmit,onCancel}=_ref;const[formData,setFormData]=useState(user||{name:'',email:'',role:'user',status:'active'});return/*#__PURE__*/_jsx(\"div\",{className:\"user-form-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"user-form\",children:[/*#__PURE__*/_jsx(\"h3\",{children:user?'تعديل المستخدم':'إضافة مستخدم جديد'}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u0627\\u0644\\u0627\\u0633\\u0645\",value:formData.name,onChange:e=>setFormData({...formData,name:e.target.value})}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",placeholder:\"\\u0627\\u0644\\u0628\\u0631\\u064A\\u062F \\u0627\\u0644\\u0625\\u0644\\u0643\\u062A\\u0631\\u0648\\u0646\\u064A\",value:formData.email,onChange:e=>setFormData({...formData,email:e.target.value})}),/*#__PURE__*/_jsxs(\"select\",{value:formData.role,onChange:e=>setFormData({...formData,role:e.target.value}),children:[/*#__PURE__*/_jsx(\"option\",{value:\"admin\",children:\"\\u0645\\u062F\\u064A\\u0631\"}),/*#__PURE__*/_jsx(\"option\",{value:\"user\",children:\"\\u0645\\u0633\\u062A\\u062E\\u062F\\u0645\"})]}),/*#__PURE__*/_jsxs(\"select\",{value:formData.status,onChange:e=>setFormData({...formData,status:e.target.value}),children:[/*#__PURE__*/_jsx(\"option\",{value:\"active\",children:\"\\u0646\\u0634\\u0637\"}),/*#__PURE__*/_jsx(\"option\",{value:\"inactive\",children:\"\\u063A\\u064A\\u0631 \\u0646\\u0634\\u0637\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>onSubmit(formData),className:\"save-btn\",children:user?'تحديث':'إضافة'}),/*#__PURE__*/_jsx(\"button\",{onClick:onCancel,className:\"cancel-btn\",children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"})]})]})});};if(!isAuthenticated){return/*#__PURE__*/_jsx(\"div\",{className:\"admin-login\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"login-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0644\\u0648\\u062D\\u0629 \\u0627\\u0644\\u062A\\u062D\\u0643\\u0645\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,children:[/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),placeholder:\"\\u0627\\u062F\\u062E\\u0644 \\u0631\\u0645\\u0632 \\u0627\\u0644\\u062F\\u062E\\u0648\\u0644\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"\\u062F\\u062E\\u0648\\u0644\"})]})]})});}if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u062C\\u0627\\u0631\\u064A \\u0627\\u0644\\u062A\\u062D\\u0645\\u064A\\u0644...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"admin-panel\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"admin-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u0644\\u0648\\u062D\\u0629 \\u0627\\u0644\\u062A\\u062D\\u0643\\u0645\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsAuthenticated(false),className:\"logout-btn\",children:\"\\u062A\\u0633\\u062C\\u064A\\u0644 \\u062E\\u0631\\u0648\\u062C\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"admin-tabs\",children:[/*#__PURE__*/_jsxs(\"button\",{className:`tab-btn ${activeTab==='orders'?'active':''}`,onClick:()=>setActiveTab('orders'),children:[/*#__PURE__*/_jsx(\"span\",{className:\"tab-icon\",children:\"\\uD83D\\uDCE6\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"})]}),/*#__PURE__*/_jsxs(\"button\",{className:`tab-btn ${activeTab==='capital'?'active':''}`,onClick:()=>setActiveTab('capital'),children:[/*#__PURE__*/_jsx(\"span\",{className:\"tab-icon\",children:\"\\uD83D\\uDCB0\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0631\\u0623\\u0633 \\u0627\\u0644\\u0645\\u0627\\u0644\"})]}),/*#__PURE__*/_jsxs(\"button\",{className:`tab-btn ${activeTab==='users'?'active':''}`,onClick:()=>setActiveTab('users'),children:[/*#__PURE__*/_jsx(\"span\",{className:\"tab-icon\",children:\"\\uD83D\\uDC65\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u0627\\u0644\\u0645\\u0633\\u062A\\u062E\\u062F\\u0645\\u064A\\u0646\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"admin-content\",children:activeTab==='users'?/*#__PURE__*/_jsxs(\"div\",{className:\"users-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0625\\u062F\\u0627\\u0631\\u0629 \\u0627\\u0644\\u0645\\u0633\\u062A\\u062E\\u062F\\u0645\\u064A\\u0646\"}),/*#__PURE__*/_jsx(\"button\",{className:\"add-btn\",onClick:()=>setEditingUser({}),children:\"\\u0625\\u0636\\u0627\\u0641\\u0629 \\u0645\\u0633\\u062A\\u062E\\u062F\\u0645 \\u062C\\u062F\\u064A\\u062F\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"users-grid\",children:users.map(user=>{var _user$name;return/*#__PURE__*/_jsxs(\"div\",{className:\"user-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"user-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"user-avatar\",children:((_user$name=user.name)===null||_user$name===void 0?void 0:_user$name.charAt(0))||'?'}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-details\",children:[/*#__PURE__*/_jsx(\"h3\",{children:user.name}),/*#__PURE__*/_jsx(\"p\",{children:user.email}),/*#__PURE__*/_jsx(\"span\",{className:`user-status ${user.status}`,children:user.status==='active'?'نشط':'غير نشط'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setEditingUser(user),className:\"edit-btn\",children:\"\\u062A\\u0639\\u062F\\u064A\\u0644\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(user.id,'users'),className:\"delete-btn\",children:\"\\u062D\\u0630\\u0641\"})]})]},user.id);})})]}):activeTab==='orders'?/*#__PURE__*/_jsxs(\"div\",{className:\"orders-section\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A (\",data.orders.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"data-table\",children:/*#__PURE__*/_jsxs(\"table\",{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0646\\u0648\\u0639\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0633\\u0639\\u0631\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u062A\\u0627\\u0631\\u064A\\u062E\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0625\\u062C\\u0631\\u0627\\u0621\\u0627\\u062A\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:data.orders.map(order=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:order.productName}),/*#__PURE__*/_jsx(\"td\",{children:order.serviceType}),/*#__PURE__*/_jsx(\"td\",{children:order.sellingPrice}),/*#__PURE__*/_jsx(\"td\",{children:new Date(order.timestamp.seconds*1000).toLocaleDateString()}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(order.id,'orders'),className:\"delete-btn\",children:\"\\u062D\\u0630\\u0641\"})})]},order.id))})]})})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"capital-section\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\u0631\\u0623\\u0633 \\u0627\\u0644\\u0645\\u0627\\u0644 (\",data.capital.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"data-table\",children:/*#__PURE__*/_jsxs(\"table\",{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0645\\u0628\\u0644\\u063A\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0645\\u0644\\u0627\\u062D\\u0638\\u0627\\u062A\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u062A\\u0627\\u0631\\u064A\\u062E\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0625\\u062C\\u0631\\u0627\\u0621\\u0627\\u062A\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:data.capital.map(item=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:item.amount}),/*#__PURE__*/_jsx(\"td\",{children:item.note}),/*#__PURE__*/_jsx(\"td\",{children:new Date(item.date).toLocaleDateString()}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(item.id,'capital'),className:\"delete-btn\",children:\"\\u062D\\u0630\\u0641\"})})]},item.id))})]})})]})}),editingUser&&/*#__PURE__*/_jsx(UserForm,{user:editingUser.id?editingUser:null,onSubmit:formData=>{if(editingUser.id){handleUpdateUser(editingUser.id,formData);}else{handleAddUser(formData);}},onCancel:()=>setEditingUser(null)})]});};export default AdminPanel;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}