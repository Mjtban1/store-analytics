{"ast":null,"code":"import React from'react';import{Chart as ChartJS,CategoryScale,LinearScale,PointElement,LineElement,Tooltip,Legend}from'chart.js';import{Line}from'react-chartjs-2';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,PointElement,LineElement,Tooltip,Legend);const RevenueChart=_ref=>{let{orders}=_ref;if(!orders||orders.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"no-data\",style:{fontFamily:'Tajawal',fontSize:'1.4rem',color:'#666',textAlign:'center',padding:'40px'},children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0628\\u064A\\u0627\\u0646\\u0627\\u062A \\u0644\\u0644\\u0639\\u0631\\u0636\"});}// تعديل طريقة معالجة البيانات لتجنب الأخطاء\nconst processData=()=>{try{const hourlyData=Array(24).fill().map(()=>({revenue:0,costs:0,count:0}));if(!orders||!Array.isArray(orders)){console.log(\"No orders data or invalid format\");return hourlyData;}orders.forEach(order=>{try{var _order$timestamp;const timestamp=(_order$timestamp=order.timestamp)!==null&&_order$timestamp!==void 0&&_order$timestamp.seconds?new Date(order.timestamp.seconds*1000):new Date(order.timestamp);const hour=timestamp.getHours();const revenue=Number(order.sellingPrice)||0;const cost=Number(order.costPrice)||0;hourlyData[hour].revenue+=revenue;hourlyData[hour].costs+=cost;hourlyData[hour].count+=1;}catch(err){console.error(\"Error processing order:\",err);}});return hourlyData;}catch(err){console.error(\"Error in processData:\",err);return Array(24).fill().map(()=>({revenue:0,costs:0,count:0}));}};const hourlyData=processData();const data={labels:Array(24).fill().map((_,i)=>`${i}:00`),datasets:[{label:'الإيرادات',data:hourlyData.map(h=>h.revenue),borderColor:'#4CAF50',backgroundColor:'rgba(76, 175, 80, 0.1)',tension:0.4,borderWidth:2,pointRadius:3,yAxisID:'y'},{label:'التكاليف',data:hourlyData.map(h=>h.costs),borderColor:'#f44336',backgroundColor:'rgba(244, 67, 54, 0.1)',tension:0.4,borderWidth:2,pointRadius:3,yAxisID:'y'},{label:'عدد الطلبات',data:hourlyData.map(h=>h.count),borderColor:'#2196F3',backgroundColor:'rgba(33, 150, 243, 0.1)',tension:0.4,borderWidth:2,pointRadius:3,yAxisID:'count'}]};const options={responsive:true,maintainAspectRatio:true,aspectRatio:window.innerWidth>=1024?2.5:1.5,elements:{line:{tension:0.3},point:{radius:3,hitRadius:8,hoverRadius:5}},plugins:{legend:{position:'top',align:'center',rtl:true,labels:{boxWidth:12,usePointStyle:true,font:{size:window.innerWidth>=1024?13:11,family:'Tajawal'},padding:20}},tooltip:{backgroundColor:'rgba(255, 255, 255, 0.95)',titleColor:'#333',bodyColor:'#666',borderColor:'#ddd',borderWidth:1,padding:10,callbacks:{title:items=>`الساعة ${items[0].label}`,label:context=>{const hour=parseInt(context.label);const hourData=hourlyData[hour];switch(context.dataset.label){case'الإيرادات':return`الإيرادات: ${context.raw.toLocaleString()} د.ع`;case'التكاليف':return`التكاليف: ${context.raw.toLocaleString()} د.ع`;case'عدد الطلبات':return`عدد الطلبات: ${context.raw} طلب`;default:return'';}}}}},scales:{x:{grid:{display:false},ticks:{font:{size:window.innerWidth>=1024?12:10},maxRotation:0,maxTicksLimit:12}},y:{beginAtZero:true,position:'left',grid:{color:'rgba(0,0,0,0.05)',drawBorder:false},ticks:{maxTicksLimit:6,font:{size:window.innerWidth>=1024?12:10},padding:10,callback:value=>`${value/1000}k د.ع`}},count:{position:'right',beginAtZero:true,grid:{display:false},ticks:{maxTicksLimit:6,font:{size:window.innerWidth>=1024?12:10},padding:10,callback:value=>`${value} طلب`}}}};// حساب الإجماليات\nconst totals=hourlyData.reduce((acc,curr)=>({revenue:acc.revenue+curr.revenue,costs:acc.costs+curr.costs,count:acc.count+curr.count}),{revenue:0,costs:0,count:0});return/*#__PURE__*/_jsxs(\"div\",{className:\"chart-box\",style:{background:'#fff',borderRadius:'12px',padding:'20px',boxShadow:'0 2px 8px rgba(0,0,0,0.05)',minHeight:'400px',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'1.1rem',color:'#666',marginBottom:'10px'},children:\"\\u0645\\u0644\\u062E\\u0635 \\u0627\\u0644\\u0625\\u064A\\u0631\\u0627\\u062F\\u0627\\u062A \\u0648\\u0627\\u0644\\u062A\\u0643\\u0627\\u0644\\u064A\\u0641\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'center',flexWrap:'wrap',gap:'20px',fontSize:'0.9rem',color:'#666'},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0627\\u0644\\u0625\\u064A\\u0631\\u0627\\u062F\\u0627\\u062A: \",hourlyData.reduce((sum,h)=>sum+h.revenue,0).toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0627\\u0644\\u062A\\u0643\\u0627\\u0644\\u064A\\u0641: \",hourlyData.reduce((sum,h)=>sum+h.costs,0).toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u0639\\u062F\\u062F \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A: \",hourlyData.reduce((sum,h)=>sum+h.count,0)]})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1,minHeight:'300px',position:'relative'},children:/*#__PURE__*/_jsx(Line,{data:data,options:options})})]});};export default RevenueChart;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}