{"ast":null,"code":"import React,{useState,useEffect}from'react';import{db}from'../../firebase/config';import{collection,addDoc,getDocs,query,where,deleteDoc,doc}from'firebase/firestore';import{getDeviceId}from'../../utils/deviceId';import Dashboard from'../Dashboard/Dashboard';import RevenueChart from'../Charts/RevenueChart';import OrderTypesChart from'../Charts/OrderTypesChart';import OrderDetails from'../Charts/OrderDetails';import'./Analytics.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Analytics=_ref=>{let{orders}=_ref;const[name,setName]=useState('');const[savedName,setSavedName]=useState('');const[docId,setDocId]=useState(null);const deviceId=getDeviceId();const[showWelcome,setShowWelcome]=useState(true);const authorizedUsers=[{names:['شمس','شموس','shams','shmoos'],type:'shams'},{names:['بنين','بنونه','baneen'],type:'baneen'},{names:['علي','على','ali'],type:'ali'},{names:['مجتبى','مجتبا','mojtaba'],type:'mojtaba'}];const isAuthorized=name=>{const lowerName=name.toLowerCase().trim();return authorizedUsers.some(user=>user.names.includes(lowerName));};const getUserType=name=>{var _authorizedUsers$find;const lowerName=name.toLowerCase().trim();return((_authorizedUsers$find=authorizedUsers.find(user=>user.names.includes(lowerName)))===null||_authorizedUsers$find===void 0?void 0:_authorizedUsers$find.type)||'unauthorized';};useEffect(()=>{const fetchName=async()=>{const q=query(collection(db,'users'),where('deviceId','==',deviceId));const querySnapshot=await getDocs(q);querySnapshot.forEach(doc=>{setSavedName(doc.data().name);setDocId(doc.id);});};fetchName();},[deviceId]);useEffect(()=>{if(savedName){const timer=setTimeout(()=>{setShowWelcome(false);},2000);return()=>clearTimeout(timer);}},[savedName]);useEffect(()=>{const fetchOrders=async()=>{try{const querySnapshot=await getDocs(collection(db,'orders'));const ordersData=querySnapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setOrders(ordersData);console.log(\"Fetched orders:\",ordersData);}catch(error){console.error(\"Error fetching orders:\",error);}};fetchOrders();},[]);const getWelcomeMessage=name=>{if(!isAuthorized(name)){return/*#__PURE__*/_jsxs(\"div\",{className:\"welcome-special unauthorized-animation\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u26D4 \\u0639\\u0630\\u0631\\u0627\\u064B! \\u0623\\u0646\\u062A \\u063A\\u064A\\u0631 \\u0645\\u0635\\u0631\\u062D \\u0644\\u0643 \\u0628\\u0627\\u0644\\u062F\\u062E\\u0648\\u0644 \\u26D4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"floating-emojis\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDEAB\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u26D4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDEA7\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A0\\uFE0F\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"unauthorized-message\",children:\"\\u0647\\u0630\\u0627 \\u0627\\u0644\\u062A\\u0637\\u0628\\u064A\\u0642 \\u0645\\u062E\\u0635\\u0635 \\u0641\\u0642\\u0637 \\u0644\\u0644\\u0645\\u0633\\u062A\\u062E\\u062F\\u0645\\u064A\\u0646 \\u0627\\u0644\\u0645\\u0635\\u0631\\u062D \\u0644\\u0647\\u0645\"})]});}const userType=getUserType(name);switch(userType){case'shams':return/*#__PURE__*/_jsxs(\"div\",{className:\"welcome-special shams-animation\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u2728 \\u0634\\u0645\\u0648\\u0633\\u0633\\u0633 \\u0627\\u0644\\u063A\\u0627\\u0644\\u064A \\u0627\\u0647\\u0644\\u0627 \\u2728\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"floating-emojis\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDF1F\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u2B50\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCAB\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDF1E\"})]})]});case'baneen':return/*#__PURE__*/_jsxs(\"div\",{className:\"welcome-special baneen-animation\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83D\\uDC9D \\u0647\\u0644\\u0627\\u0648\\u0648\\u0648\\u0648 \\u0628\\u0646\\u0648\\u0646\\u0647 \\uD83D\\uDC9D\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"floating-emojis\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDF80\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDC96\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u2728\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83E\\uDD8B\"})]})]});case'ali':return/*#__PURE__*/_jsxs(\"div\",{className:\"welcome-special ali-animation\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83C\\uDF1F \\u0645\\u0631\\u062D\\u0628\\u0627\\u064B \\u0639\\u0644\\u0627\\u0648\\u064A\\u064A\\u064A\\u064A \\uD83C\\uDF1F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"floating-emojis\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCAA\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDC51\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDF89\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A1\"})]})]});case'mojtaba':return/*#__PURE__*/_jsxs(\"div\",{className:\"welcome-special mojtaba-animation\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83C\\uDF19 \\u0623\\u0647\\u0644\\u0627\\u064B \\u0645\\u062C\\u062A\\u0628\\u0649 \\uD83C\\uDF19\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"floating-emojis\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDF19\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u2728\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDF1F\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCAB\"})]})]});default:return null;}};const handleSubmit=async e=>{e.preventDefault();if(!isAuthorized(name)){setSavedName(name);// Still set the name to show unauthorized message\nreturn;}try{const docRef=await addDoc(collection(db,'users'),{name:name,deviceId:deviceId,timestamp:new Date()});setSavedName(name);setDocId(docRef.id);setName('');}catch(error){console.error(\"Error adding name: \",error);}};const handleRemove=async()=>{try{if(docId){await deleteDoc(doc(db,'users',docId));setSavedName('');setDocId(null);}}catch(error){console.error(\"Error removing name: \",error);}};const UserUnauthorizedScreen=()=>/*#__PURE__*/_jsx(\"div\",{className:\"unauthorized-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"welcome-special unauthorized-animation\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u26D4 \\u0639\\u0630\\u0631\\u0627\\u064B! \\u0623\\u0646\\u062A \\u063A\\u064A\\u0631 \\u0645\\u0635\\u0631\\u062D \\u0644\\u0643 \\u0628\\u0627\\u0644\\u062F\\u062E\\u0648\\u0644 \\u26D4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"floating-emojis\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDEAB\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u26D4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDEA7\"}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A0\\uFE0F\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"unauthorized-message\",children:\"\\u0647\\u0630\\u0627 \\u0627\\u0644\\u062A\\u0637\\u0628\\u064A\\u0642 \\u0645\\u062E\\u0635\\u0635 \\u0641\\u0642\\u0637 \\u0644\\u0644\\u0645\\u0633\\u062A\\u062E\\u062F\\u0645\\u064A\\u0646 \\u0627\\u0644\\u0645\\u0635\\u0631\\u062D \\u0644\\u0647\\u0645\"}),/*#__PURE__*/_jsx(\"button\",{className:\"reset-btn\",onClick:handleRemove,children:\"\\u0627\\u0644\\u0639\\u0648\\u062F\\u0629 \\u0644\\u0644\\u0635\\u0641\\u062D\\u0629 \\u0627\\u0644\\u0631\\u0626\\u064A\\u0633\\u064A\\u0629\"})]})});const renderAnalyticsStats=()=>{const totalRevenue=(orders===null||orders===void 0?void 0:orders.reduce((sum,order)=>sum+Number(order.sellingPrice),0))||0;const totalCosts=(orders===null||orders===void 0?void 0:orders.reduce((sum,order)=>sum+Number(order.costPrice),0))||0;const profit=totalRevenue-totalCosts;const profitMargin=totalRevenue>0?(profit/totalRevenue*100).toFixed(1):0;return/*#__PURE__*/_jsx(\"div\",{className:\"analytics-stats\",style:{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(280px, 1fr))',gap:'25px',padding:'20px',margin:'20px 0',perspective:'1000px'},children:[{title:'إجمالي الإيرادات',value:`${totalRevenue.toLocaleString()} د.ع`,icon:'💰',emoji:'💵',gradient:'linear-gradient(135deg, #28c76f, #19a85f)',shadowColor:'rgba(40, 199, 111, 0.3)',particles:['💵','💎','💰'],trend:'+12.5%',trendUp:true,borderColor:'#28c76f'},{title:'إجمالي التكاليف',value:`${totalCosts.toLocaleString()} د.ع`,icon:'💳',emoji:'💸',gradient:'linear-gradient(135deg, #e83e8c, #d92550)',shadowColor:'rgba(232, 62, 140, 0.3)',particles:['💸','💱','💴'],trend:'-8.3%',trendUp:false,borderColor:'#e83e8c'},{title:'صافي الربح',value:`${profit.toLocaleString()} د.ع`,icon:'✨',emoji:'💫',gradient:'linear-gradient(135deg, #2196F3, #1e88e5)',shadowColor:'rgba(33, 150, 243, 0.3)',particles:['⭐','✨','💫'],trend:'+15.2%',trendUp:true,borderColor:'#2196F3'},{title:'هامش الربح',value:`${profitMargin}%`,icon:'📊',emoji:'📈',gradient:'linear-gradient(135deg, #FF9800, #fb8c00)',shadowColor:'rgba(255, 152, 0, 0.3)',particles:['📊','📈','💹'],trend:'+5.7%',trendUp:true,borderColor:'#FF9800'}].map((stat,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",style:{background:stat.gradient,borderRadius:'20px',padding:'25px',color:'white',position:'relative',overflow:'hidden',minHeight:'180px',boxShadow:`0 8px 25px ${stat.shadowColor}`,border:`2px solid ${stat.borderColor}`,transition:'all 0.3s ease',cursor:'pointer',transform:'translateZ(0)',backfaceVisibility:'hidden'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-pattern\"}),/*#__PURE__*/_jsx(\"div\",{className:\"main-emoji\",children:stat.emoji}),stat.particles.map((particle,i)=>/*#__PURE__*/_jsx(\"span\",{className:`floating-particle particle-${i}`,children:particle},i)),/*#__PURE__*/_jsxs(\"div\",{className:\"card-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"card-icon\",children:stat.icon}),/*#__PURE__*/_jsx(\"h3\",{children:stat.title})]}),/*#__PURE__*/_jsx(\"div\",{className:\"card-value\",children:stat.value}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-trend\",children:[/*#__PURE__*/_jsx(\"span\",{className:`trend-arrow ${stat.trendUp?'up':'down'}`,children:stat.trendUp?'↗':'↘'}),/*#__PURE__*/_jsx(\"span\",{className:\"trend-value\",children:stat.trend}),/*#__PURE__*/_jsx(\"span\",{className:\"trend-period\",children:\"\\u0645\\u0642\\u0627\\u0631\\u0646\\u0629 \\u0628\\u0627\\u0644\\u0634\\u0647\\u0631 \\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"})]})]})]},index))});};return/*#__PURE__*/_jsx(\"div\",{className:\"analytics-container\",children:!savedName?/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"name-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:name,onChange:e=>setName(e.target.value),placeholder:\"\\u0623\\u062F\\u062E\\u0644 \\u0627\\u0633\\u0645\\u0643 \\u0647\\u0646\\u0627\",className:\"name-input arabic-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"submit-btn\",children:\"\\u062A\\u0645\"})]}):showWelcome?/*#__PURE__*/_jsx(\"div\",{className:\"welcome-container\",children:getWelcomeMessage(savedName)}):isAuthorized(savedName)?/*#__PURE__*/_jsx(Dashboard,{orders:orders}):/*#__PURE__*/_jsx(UserUnauthorizedScreen,{})});};export default Analytics;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}