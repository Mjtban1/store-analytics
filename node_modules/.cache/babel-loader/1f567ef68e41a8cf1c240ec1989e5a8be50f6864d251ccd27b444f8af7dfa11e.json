{"ast":null,"code":"import React,{useMemo}from'react';import{Chart as ChartJS,ArcElement,Tooltip,Legend}from'chart.js';import{Doughnut}from'react-chartjs-2';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(ArcElement,Tooltip,Legend);const OrderTypesChart=_ref=>{let{orders}=_ref;const processedData=useMemo(()=>{if(!(orders!==null&&orders!==void 0&&orders.length))return null;try{const summary={games:{count:0,revenue:0,label:'ألعاب',color:'#4CAF50'},subscriptions:{count:0,revenue:0,label:'اشتراكات',color:'#2196F3'},services:{count:0,revenue:0,label:'خدمات',color:'#FF9800'}};orders.forEach(order=>{try{const type=order.serviceType;if(summary[type]){summary[type].count++;const revenue=Number(order.sellingPrice)||0;if(!isNaN(revenue)){summary[type].revenue+=revenue;}}}catch(err){console.error(\"Error processing individual order:\",err);}});return summary;}catch(err){console.error(\"Error processing orders data:\",err);return null;}},[orders]);if(!processedData){return/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'20px',color:'#666',fontFamily:'Tajawal'},children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0628\\u064A\\u0627\\u0646\\u0627\\u062A \\u0644\\u0644\\u0639\\u0631\\u0636\"});}const chartData={labels:Object.values(processedData).map(item=>item.label),datasets:[{data:Object.values(processedData).map(item=>item.count),backgroundColor:Object.values(processedData).map(item=>item.color),borderWidth:0,borderRadius:5,spacing:2,hoverOffset:15}]};const options={responsive:true,maintainAspectRatio:false,// السماح بتغيير النسب\ncutout:window.innerWidth<768?'65%':'75%',// تقليل حجم الفراغ في المنتصف للموبايل\nlayout:{padding:{top:20,// إضافة padding للسماح بالتوسع عند hover\nbottom:20,left:20,right:20}},plugins:{legend:{display:false// إخفاء الليجند الافتراضي\n},tooltip:{enabled:true,backgroundColor:'rgba(255, 255, 255, 0.98)',titleColor:'#333',bodyColor:'#666',borderColor:'#ddd',borderWidth:2,cornerRadius:8,boxShadow:'0 4px 15px rgba(0,0,0,0.1)',padding:15,rtl:true,titleFont:{family:'Tajawal',size:14,weight:'bold'},bodyFont:{family:'Tajawal',size:window.innerWidth<768?11:13},callbacks:{label:context=>{const data=Object.values(processedData)[context.dataIndex];const percentage=(data.count/orders.length*100).toFixed(1);return[`${data.label}: ${data.count} طلب`,`الإيرادات: ${data.revenue.toLocaleString()} د.ع`,`النسبة: ${percentage}%`];}},z:100,// زيادة z-index للتأكد من ظهورها فوق العناصر الأخرى\nposition:'nearest',events:['mousemove','mouseout','touchstart','touchmove']}},hover:{mode:'nearest',intersect:true,animationDuration:200,onHover:(event,elements)=>{if(elements&&elements.length){event.native.target.style.cursor='pointer';}else{event.native.target.style.cursor='default';}}},elements:{arc:{borderWidth:0,borderRadius:8,hoverBorderWidth:0,hoverOffset:10,// تقليل مسافة الحركة عند hover\nhoverBorderColor:'transparent'}},animation:{animateRotate:true,animateScale:true,duration:500}};// حساب الإجماليات والنسب\nconst totalOrders=orders.length;const totalRevenue=Object.values(processedData).reduce((sum,item)=>sum+item.revenue,0);// حساب هامش الربح الإجمالي\nconst totalCost=orders.reduce((sum,order)=>sum+Number(order.costPrice),0);const profitMargin=((totalRevenue-totalCost)/totalRevenue*100).toFixed(1);return/*#__PURE__*/_jsxs(\"div\",{style:{background:'#fff',borderRadius:'15px',padding:window.innerWidth<768?'15px 10px':'20px',boxShadow:'0 2px 10px rgba(0,0,0,0.05)',display:'flex',flexDirection:'column',alignItems:'center',minHeight:window.innerWidth<768?'400px':'500px',maxHeight:window.innerWidth<768?'450px':'600px',overflowY:'auto',position:'relative',isolation:'isolate'// إضافة هذه الخاصية لإنشاء سياق تكديس جديد\n},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:window.innerWidth<768?'1rem':'1.1rem',color:'#666',marginBottom:window.innerWidth<768?'15px':'20px',fontFamily:'Tajawal',fontWeight:'bold',padding:'0 10px',textAlign:'center',position:'relative',zIndex:1},children:\"\\u062A\\u0648\\u0632\\u064A\\u0639 \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A \\u062D\\u0633\\u0628 \\u0627\\u0644\\u0646\\u0648\\u0639\"}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative',width:'100%',maxWidth:window.innerWidth<768?'250px':'300px',// تصغير حجم الدائرة\nheight:window.innerWidth<768?'250px':'300px',margin:'0 auto',zIndex:2// زيادة z-index للتأكد من أن الرسم البياني فوق العناصر الأخرى\n},children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:0,left:0,right:0,bottom:0,display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsx(Doughnut,{data:chartData,options:options})}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',top:'50%',left:'50%',transform:'translate(-50%, -50%)',textAlign:'center',fontFamily:'Tajawal',width:'100%',maxWidth:window.innerWidth<768?'120px':'150px',zIndex:1// تحديد z-index أقل من الرسم البياني\n},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:window.innerWidth<768?'1.5rem':'2rem',fontWeight:'800',color:'#333',marginBottom:window.innerWidth<768?'3px':'5px'},children:totalOrders}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:window.innerWidth<768?'0.8rem':'0.9rem',color:'#666',marginBottom:window.innerWidth<768?'5px':'10px'},children:\"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:window.innerWidth<768?'0.9rem':'1.1rem',color:'#4CAF50',fontWeight:'bold'},children:[totalRevenue.toLocaleString(),\" \\u062F.\\u0639\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{display:'grid',gridTemplateColumns:window.innerWidth<768?'1fr 1fr':'repeat(3, 1fr)',gap:window.innerWidth<768?'10px':'20px',marginTop:window.innerWidth<768?'15px':'30px',width:'100%',padding:'0 10px',flexWrap:'wrap',position:'relative',zIndex:1},children:Object.values(processedData).map((item,index)=>/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'5px',justifyContent:'center'},children:[/*#__PURE__*/_jsx(\"span\",{style:{width:window.innerWidth<768?'10px':'12px',height:window.innerWidth<768?'10px':'12px',borderRadius:'50%',backgroundColor:item.color}}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:window.innerWidth<768?'0.8rem':'0.9rem',color:'#666',fontFamily:'Tajawal'},children:item.label})]},index))}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:window.innerWidth<768?'1fr':'1fr 1fr',gap:window.innerWidth<768?'10px':'30px',marginTop:window.innerWidth<768?'15px':'30px',padding:window.innerWidth<768?'15px':'15px',background:'#f8f9ff',borderRadius:'10px',width:'92%',// تقليل العرض لإبعادها عن الحواف\nmargin:window.innerWidth<768?'15px auto 0':'30px auto 0',// توسيط العنصر\nposition:'relative',zIndex:1},children:[/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',fontFamily:'Tajawal',padding:window.innerWidth<768?'8px':'10px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#666',fontSize:window.innerWidth<768?'0.8rem':'0.9rem'},children:\"\\u0647\\u0627\\u0645\\u0634 \\u0627\\u0644\\u0631\\u0628\\u062D\"}),/*#__PURE__*/_jsxs(\"div\",{style:{color:profitMargin>0?'#4CAF50':'#f44336',fontSize:window.innerWidth<768?'1rem':'1.1rem',fontWeight:'bold'},children:[profitMargin,\"%\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',fontFamily:'Tajawal',padding:window.innerWidth<768?'8px':'10px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{color:'#666',fontSize:window.innerWidth<768?'0.8rem':'0.9rem'},children:\"\\u0645\\u062A\\u0648\\u0633\\u0637 \\u0642\\u064A\\u0645\\u0629 \\u0627\\u0644\\u0637\\u0644\\u0628\"}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#2196F3',fontSize:window.innerWidth<768?'1rem':'1.1rem',fontWeight:'bold'},children:[(totalRevenue/totalOrders).toFixed(0).toLocaleString(),\" \\u062F.\\u0639\"]})]})]})]});};// إضافة أنماط CSS للتحكم في التفاعلات\nconst styles=`\n    @keyframes scaleIn {\n        from { transform: scale(0.95); opacity: 0.7; }\n        to { transform: scale(1); opacity: 1; }\n    }\n\n    .chart-tooltip {\n        animation: scaleIn 0.2s ease-out;\n        box-shadow: 0 4px 20px rgba(0,0,0,0.15);\n    }\n`;// إضافة الأنماط إلى الصفحة\nconst styleSheet=document.createElement('style');styleSheet.innerText=styles;document.head.appendChild(styleSheet);export default OrderTypesChart;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}