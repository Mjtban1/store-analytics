{"ast":null,"code":"import React,{useState}from'react';import{Chart as ChartJS,CategoryScale,LinearScale,PointElement,LineElement,Tooltip,Legend}from'chart.js';import{Line}from'react-chartjs-2';import{format}from'date-fns';import{ar}from'date-fns/locale';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,PointElement,LineElement,Tooltip,Legend);const RevenueChart=_ref=>{let{orders}=_ref;if(!orders||orders.length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"no-data\",style:{fontFamily:'Tajawal',fontSize:'1.4rem',color:'#666',textAlign:'center',padding:'40px'},children:\"\\u0644\\u0627 \\u062A\\u0648\\u062C\\u062F \\u0628\\u064A\\u0627\\u0646\\u0627\\u062A \\u0644\\u0644\\u0639\\u0631\\u0636\"});}// تعديل طريقة معالجة البيانات لتجنب الأخطاء\nconst processData=()=>{try{const hourlyData=Array(24).fill().map(()=>({revenue:0,costs:0,count:0}));if(!orders||!Array.isArray(orders)){console.log(\"No orders data or invalid format\");return hourlyData;}orders.forEach(order=>{try{var _order$timestamp;const timestamp=(_order$timestamp=order.timestamp)!==null&&_order$timestamp!==void 0&&_order$timestamp.seconds?new Date(order.timestamp.seconds*1000):new Date(order.timestamp);const hour=timestamp.getHours();const revenue=Number(order.sellingPrice)||0;const cost=Number(order.costPrice)||0;hourlyData[hour].revenue+=revenue;hourlyData[hour].costs+=cost;hourlyData[hour].count+=1;}catch(err){console.error(\"Error processing order:\",err);}});return hourlyData;}catch(err){console.error(\"Error in processData:\",err);return Array(24).fill().map(()=>({revenue:0,costs:0,count:0}));}};const hourlyData=processData();const data={labels:Array(24).fill().map((_,i)=>`${i}:00`),datasets:[{label:'الإيرادات',data:hourlyData.map(h=>h.revenue),borderColor:'#4CAF50',backgroundColor:'rgba(76, 175, 80, 0.1)',tension:0.4,borderWidth:2,pointRadius:3,yAxisID:'y'},{label:'التكاليف',data:hourlyData.map(h=>h.costs),borderColor:'#f44336',backgroundColor:'rgba(244, 67, 54, 0.1)',tension:0.4,borderWidth:2,pointRadius:3,yAxisID:'y'},{label:'عدد الطلبات',data:hourlyData.map(h=>h.count),borderColor:'#2196F3',backgroundColor:'rgba(33, 150, 243, 0.1)',tension:0.4,borderWidth:2,pointRadius:3,yAxisID:'count'}]};const options={responsive:true,maintainAspectRatio:true,aspectRatio:window.innerWidth>=1024?2.5:1.5,elements:{line:{tension:0.3},point:{radius:3,hitRadius:8,hoverRadius:5}},plugins:{legend:{position:'top',align:'center',rtl:true,labels:{boxWidth:12,usePointStyle:true,font:{size:window.innerWidth>=1024?13:11,family:'Tajawal',weight:'bold'// إضافة الخط العريض\n},padding:20}},tooltip:{backgroundColor:'rgba(255, 255, 255, 0.95)',titleColor:'#333',bodyColor:'#666',borderColor:'#ddd',borderWidth:1,padding:10,callbacks:{title:items=>`الساعة ${items[0].label}`,label:context=>{const hour=parseInt(context.label);const hourData=hourlyData[hour];switch(context.dataset.label){case'الإيرادات':return`الإيرادات: ${context.raw.toLocaleString()} د.ع`;case'التكاليف':return`التكاليف: ${context.raw.toLocaleString()} د.ع`;case'عدد الطلبات':return`عدد الطلبات: ${context.raw} طلب`;default:return'';}}},titleFont:{family:'Tajawal',weight:'bold',size:14},bodyFont:{family:'Tajawal',weight:'bold',size:13}}},scales:{x:{grid:{display:false},ticks:{font:{size:window.innerWidth>=1024?12:10,family:'Tajawal',weight:'bold'},maxRotation:0,maxTicksLimit:12}},y:{beginAtZero:true,position:'left',grid:{color:'rgba(0,0,0,0.05)',drawBorder:false},ticks:{maxTicksLimit:6,font:{size:window.innerWidth>=1024?12:10,family:'Tajawal',weight:'bold'},padding:10,callback:value=>`${value/1000}k د.ع`}},count:{position:'right',beginAtZero:true,grid:{display:false},ticks:{maxTicksLimit:6,font:{size:window.innerWidth>=1024?12:10,family:'Tajawal',weight:'bold'},padding:10,callback:value=>`${value} طلب`}}}};// حساب الإجماليات\nconst totals=hourlyData.reduce((acc,curr)=>({revenue:acc.revenue+curr.revenue,costs:acc.costs+curr.costs,count:acc.count+curr.count}),{revenue:0,costs:0,count:0});// إضافة حالة للتحكم في الفلترة والترتيب\nconst[filterType,setFilterType]=useState('all');const[sortBy,setSortBy]=useState('date');const[sortOrder,setSortOrder]=useState('desc');// دالة لحساب الربح\nconst calculateProfit=(selling,cost)=>{const sellingPrice=Number(selling);const costPrice=Number(cost);const commission=sellingPrice*0.05;// 5% عمولة\nreturn sellingPrice-costPrice-commission;};return/*#__PURE__*/_jsxs(\"div\",{className:\"analytics-wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chart-box\",style:{background:'#fff',borderRadius:'12px',padding:'20px',boxShadow:'0 2px 8px rgba(0,0,0,0.05)',minHeight:'400px',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px',textAlign:'center',fontFamily:'Tajawal'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'1.1rem',color:'#666',marginBottom:'10px',fontWeight:'bold'},children:\"\\u0645\\u0644\\u062E\\u0635 \\u0627\\u0644\\u0625\\u064A\\u0631\\u0627\\u062F\\u0627\\u062A \\u0648\\u0627\\u0644\\u062A\\u0643\\u0627\\u0644\\u064A\\u0641\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'center',flexWrap:'wrap',gap:'20px',fontSize:'0.9rem',color:'#666',fontWeight:'bold'},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0627\\u0644\\u0625\\u064A\\u0631\\u0627\\u062F\\u0627\\u062A: \",hourlyData.reduce((sum,h)=>sum+h.revenue,0).toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u0625\\u062C\\u0645\\u0627\\u0644\\u064A \\u0627\\u0644\\u062A\\u0643\\u0627\\u0644\\u064A\\u0641: \",hourlyData.reduce((sum,h)=>sum+h.costs,0).toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u0639\\u062F\\u062F \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A: \",hourlyData.reduce((sum,h)=>sum+h.count,0)]})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1,minHeight:'300px',position:'relative'},children:/*#__PURE__*/_jsx(Line,{data:data,options:options})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"orders-details-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"section-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u062A\\u0641\\u0627\\u0635\\u064A\\u0644 \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters\",children:[/*#__PURE__*/_jsxs(\"select\",{value:filterType,onChange:e=>setFilterType(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"\\u062C\\u0645\\u064A\\u0639 \\u0627\\u0644\\u0637\\u0644\\u0628\\u0627\\u062A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"games\",children:\"\\u0627\\u0644\\u0623\\u0644\\u0639\\u0627\\u0628\"}),/*#__PURE__*/_jsx(\"option\",{value:\"subscriptions\",children:\"\\u0627\\u0644\\u0627\\u0634\\u062A\\u0631\\u0627\\u0643\\u0627\\u062A\"}),/*#__PURE__*/_jsx(\"option\",{value:\"services\",children:\"\\u0627\\u0644\\u062E\\u062F\\u0645\\u0627\\u062A\"})]}),/*#__PURE__*/_jsxs(\"select\",{value:sortBy,onChange:e=>setSortBy(e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"date\",children:\"\\u062A\\u0627\\u0631\\u064A\\u062E \\u0627\\u0644\\u062A\\u0633\\u062C\\u064A\\u0644\"}),/*#__PURE__*/_jsx(\"option\",{value:\"profit\",children:\"\\u0627\\u0644\\u0631\\u0628\\u062D\"}),/*#__PURE__*/_jsx(\"option\",{value:\"price\",children:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0628\\u064A\\u0639\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"sort-btn\",onClick:()=>setSortOrder(prev=>prev==='asc'?'desc':'asc'),children:sortOrder==='asc'?'⬆️':'⬇️'})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"orders-table-wrapper\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"orders-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0645\\u0646\\u062A\\u062C\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0646\\u0648\\u0639\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u062A\\u0627\\u0631\\u064A\\u062E\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u062A\\u0643\\u0644\\u0641\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0633\\u0639\\u0631 \\u0627\\u0644\\u0628\\u064A\\u0639\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0639\\u0645\\u0648\\u0644\\u0629\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u0631\\u0628\\u062D\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0627\\u0644\\u062E\\u064A\\u0627\\u0631\\u0627\\u062A\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:orders.filter(order=>filterType==='all'?true:order.serviceType===filterType).sort((a,b)=>{const sortModifier=sortOrder==='asc'?1:-1;switch(sortBy){case'date':return sortModifier*(new Date(b.timestamp.seconds*1000)-new Date(a.timestamp.seconds*1000));case'profit':return sortModifier*(calculateProfit(b.sellingPrice,b.costPrice)-calculateProfit(a.sellingPrice,a.costPrice));case'price':return sortModifier*(Number(b.sellingPrice)-Number(a.sellingPrice));default:return 0;}}).map((order,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"order-row\",children:[/*#__PURE__*/_jsx(\"td\",{children:index+1}),/*#__PURE__*/_jsx(\"td\",{className:\"product-name\",children:order.productName}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:`type-badge ${order.serviceType}`,children:order.serviceType==='games'?'ألعاب':order.serviceType==='subscriptions'?'اشتراكات':'خدمات'})}),/*#__PURE__*/_jsx(\"td\",{dir:\"ltr\",children:format(new Date(order.timestamp.seconds*1000),'dd/MM/yyyy HH:mm',{locale:ar})}),/*#__PURE__*/_jsxs(\"td\",{children:[Number(order.costPrice).toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"td\",{children:[Number(order.sellingPrice).toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"td\",{children:[(Number(order.sellingPrice)*0.05).toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"td\",{className:`profit ${calculateProfit(order.sellingPrice,order.costPrice)>0?'positive':'negative'}`,children:[calculateProfit(order.sellingPrice,order.costPrice).toLocaleString(),\" \\u062F.\\u0639\"]}),/*#__PURE__*/_jsxs(\"td\",{className:\"actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"action-btn edit\",title:\"\\u062A\\u0639\\u062F\\u064A\\u0644\",children:\"\\u270F\\uFE0F\"}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn delete\",title:\"\\u062D\\u0630\\u0641\",children:\"\\uD83D\\uDDD1\\uFE0F\"}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn receipt\",title:\"\\u0625\\u0646\\u0634\\u0627\\u0621 \\u0625\\u064A\\u0635\\u0627\\u0644\",children:\"\\uD83D\\uDCC4\"}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn archive\",title:\"\\u0623\\u0631\\u0634\\u0641\\u0629\",children:\"\\uD83D\\uDCE6\"})]})]},order.id||index))})]})})]})]});};// إضافة الأنماط\nconst styles=`\n.analytics-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 2rem;\n}\n\n.orders-details-section {\n    background: white;\n    border-radius: 15px;\n    padding: 1.5rem;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.05);\n}\n\n.section-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n}\n\n.filters {\n    display: flex;\n    gap: 1rem;\n    align-items: center;\n}\n\n.filter-select {\n    padding: 8px 12px;\n    border: 1.5px solid #e0e0fe;\n    border-radius: 8px;\n    font-family: 'Tajawal', Arial, sans-serif;\n    font-size: 0.9rem;\n    color: #666;\n    background: white;\n}\n\n.sort-btn {\n    padding: 8px;\n    border: none;\n    background: none;\n    cursor: pointer;\n    font-size: 1.2rem;\n}\n\n.orders-table-wrapper {\n    overflow-x: auto;\n}\n\n.orders-table {\n    width: 100%;\n    border-collapse: separate;\n    border-spacing: 0;\n}\n\n.orders-table th,\n.orders-table td {\n    padding: 12px;\n    text-align: right;\n}\n\n.orders-table th {\n    background: #f8f9ff;\n    font-weight: bold;\n    color: #666;\n    position: sticky;\n    top: 0;\n    z-index: 10;\n}\n\n.order-row {\n    border-bottom: 1px solid #f0f0f0;\n    transition: background-color 0.2s;\n}\n\n.order-row:hover {\n    background-color: #f8f9ff;\n}\n\n.type-badge {\n    padding: 4px 8px;\n    border-radius: 6px;\n    font-size: 0.85rem;\n    font-weight: bold;\n}\n\n.type-badge.games { background: rgba(76, 175, 80, 0.1); color: #4CAF50; }\n.type-badge.subscriptions { background: rgba(33, 150, 243, 0.1); color: #2196F3; }\n.type-badge.services { background: rgba(255, 152, 0, 0.1); color: #FF9800; }\n\n.profit.positive { color: #4CAF50; }\n.profit.negative { color: #dc3545; }\n\n.actions {\n    display: flex;\n    gap: 8px;\n    justify-content: center;\n}\n\n.action-btn {\n    padding: 6px;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: transform 0.2s;\n    background: none;\n}\n\n.action-btn:hover {\n    transform: translateY(-2px);\n}\n\n@media screen and (max-width: 768px) {\n    .section-header {\n        flex-direction: column;\n        gap: 1rem;\n    }\n\n    .filters {\n        width: 100%;\n        justify-content: space-between;\n    }\n\n    .filter-select {\n        flex: 1;\n    }\n\n    .orders-table {\n        font-size: 0.9rem;\n    }\n\n    .actions {\n        flex-wrap: wrap;\n    }\n}\n`;// إضافة الأنماط إلى الصفحة\nconst styleSheet=document.createElement('style');styleSheet.innerText=styles;document.head.appendChild(styleSheet);export default RevenueChart;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}